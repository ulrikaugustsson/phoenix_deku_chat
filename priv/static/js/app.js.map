{"version":3,"sources":["app.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","Application","element","this","options","sources","Emitter","prototype","use","plugin","option","name","val","set","data","emit","mount","unmount","component-emitter",2,"onBlur","onChange","onClick","onContextMenu","onCopy","onCut","onDoubleClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onFocus","onInput","onInvalid","onKeyDown","onKeyPress","onKeyUp","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onPaste","onReset","onScroll","onSubmit","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onWheel",3,"tree","scene","deku","document","render","renderString","./application","./render","./stringify",4,"type","node","v","component-type",5,"app","container","opts","teardown","removeNativeEventListeners","removeNativeElement","off","onunmount","onmount","onupdate","invalidate","currentElement","connections","forEach","update","mountEntity","entity","register","setSources","children","id","entities","commit","trigger","context","virtualElement","renderEntity","nativeElement","toNative","mountQueue","push","unmountEntity","entityId","unmountChildren","removeAllEvents","componentEntities","components","component","fn","result","setState","nextState","updateEntityState","batching","frameId","raf","isRendering","clearFrame","currentNativeElement","patch","rootId","updateChildren","console","info","body","warn","removeAllChildren","appendChild","flushMountQueue","shift","cancel","updateEntity","shouldUpdate","currentTree","nextProps","pendingProps","pendingState","previousState","state","previousProps","props","nextTree","childId","removeElement","path","vnode","nodeType","toNativeText","toNativeEmptyElement","toNativeElement","toNativeComponent","text","createTextNode","el","attributes","tagName","childNodes","svg","isElement","createElementNS","namespace","createElement","value","setAttribute","child","childEl","parentNode","__entity__","__path__","Entity","assign","prev","next","diffNode","leftType","rightType","replaceElement","diffText","diffElement","diffComponent","previous","current","diffChildren","keyMapReducer","acc","key","index","hasKeys","positions","Array","slice","apply","leftKeys","reduce","rightKeys","currentChildren","leftNode","leftPath","rightNode","rightPath","childPath","maxLength","Math","max","undefined","newPosition","target","insertBefore","diffAttributes","nextAttrs","prevAttrs","events","removeAttribute","targetId","updateEntityProps","childrenByPath","entityHandlers","handlers","removals","removeChild","isWithinPath","handlerPath","removeEvent","parent","indexOf","newEl","updateNativeElement","ownerId","addEvent","innerHTML","setElementValue","isAttribute","setAttributeNS","firstChild","args","defaults","defaultProps","dirty","validate","bool","registerEntity","registered","registerSources","map","sourceToPropertyName","propTypes","source","prop","changes","addNativeEventListeners","eventType","rootElement","addEventListener","handleEvent","removeEventListener","event","keypath","get","delegateTarget","del","inspect","isDom","getRootElement","on","remove","uid","initialState","displayName","parentElement","start","selectionStart","end","selectionEnd","setSelectionRange","./events","./node-type","./svg","component-raf","fast.js/forEach","fast.js/object/assign","fast.js/reduce","get-uid","is-dom","object-defaults","object-path",6,"attrs","str","isValidAttributeValue","attr","valueType","stringify","optProps","beforeMount","beforeRender","stringifyNode",7,"is-svg-attribute","is-svg-element",8,"obj","mixin","_callbacks","once","arguments","removeListener","removeAllListeners","callbacks","cb","splice","len","listeners","hasListeners",9,"fallback","curr","Date","getTime","ms","req","setTimeout","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","clearTimeout",10,"toString","Object","valueOf",11,"bindInternal3","subject","thisContext","iterator","../function/bindInternal3",12,"bindInternal4","initialValue","../function/bindInternal4",13,"forEachArray","forEachObject","./array/forEach","./object/forEach",14,"func","b","c",15,"d",16,"totalKeys","keys","j","totalArgs",17,18,19,"reduceArray","reduceObject","./array/reduce","./object/reduce",20,"counter","now","random",21,"Node","nodeName",22,"cx","cy","dx","dy","fill","fillOpacity","fontFamily","fontSize","fx","fy","gradientTransform","gradientUnits","markerEnd","markerMid","markerStart","offset","opacity","patternContentUnits","patternUnits","points","preserveAspectRatio","rx","ry","spreadMethod","stopColor","stopOpacity","stroke","strokeDasharray","strokeLinecap","strokeOpacity","strokeWidth","textAnchor","transform","version","viewBox","x1","x2","x","y1","y2","y",23,"elements","animate","circle","defs","ellipse","g","line","linearGradient","mask","pattern","polygon","polyline","radialGradient","rect","stop","tspan",24,"getOwnPropertyNames",25,"root","factory","define","amd","objectPath","isEmpty","isArray","isString","_hasOwnProperty","toStr","isNumber","isObject","isBoolean","getKey","intKey","parseInt","doNotReplace","split","currentPath","oldVal","hasOwnProperty","proxy","bind","has","ensureExists","insert","at","arr","empty","coalesce","paths","defaultValue",26,"TypeError","flatten","array-flatten","sliced",27,"flattenWithDepth","array","depth","flattenForever","arrayFlatten",28,"./lib/sliced",29,"sliceEnd","ret",30,"_interopRequireDefault","__esModule","default","_vendorPhoenixJs","_virtualElement","_virtualElement2","_deku","_messages","_messages2","chatMessages","messages","log","querySelector","socket","Socket","logger","kind","msg","connect","user_id","$input","$username","onOpen","ev","onError","onClose","chan","channel","join","receive","after","keyCode","user","../vendor/phoenix.js","./messages","virtual-element",31,"defineProperty","Component","_ref","messageElements","mountEle","message","href","style","afterRender","scrollTop","scrollHeight",32,"_classCallCheck","instance","Constructor","_createClass","defineProperties","descriptor","enumerable","configurable","writable","protoProps","staticProps","SOCKET_STATES","connecting","open","closing","closed","CHANNEL_STATES","errored","joined","joining","CHANNEL_EVENTS","close","error","reply","leave","TRANSPORTS","longpoll","websocket","Push","payload","receivedResp","afterHook","recHooks","sent","_this","ref","makeRef","refEvent","replyEventName","matchReceive","cancelRefEvent","cancelAfter","startAfter","topic","status","callback","response","timer","filter","h","_this2","Channel","params","_this3","bindings","joinedOnce","joinPush","pushBuffer","rejoinTimer","Timer","rejoinUntilConnected","reconnectAfterMs","reset","reason","isConnected","rejoin","sendJoin","pushEvent","canPush","send","_this4","triggerEvent","onMessage","endPoint","_this5","stateChangeCallbacks","channels","sendBuffer","transport","WebSocket","LongPoll","heartbeatIntervalMs","tries","longpollerTimeout","reconnectTimer","location","protocol","match","uri","Ajax","appendParams","charAt","host","conn","onclose","_this6","disconnect","endPointURL","timeout","onopen","onConnOpen","onerror","onConnError","onmessage","onConnMessage","onConnClose","_this7","flushSendBuffer","skipHeartbeat","clearInterval","heartbeatTimer","setInterval","sendHeartbeat","triggerChanError","readyState","connectionState","isMember","chanParams","_this8","JSON","newRef","rawMessage","parse","token","pollEndpoint","normalizeEndpoint","poll","replace","RegExp","format","closeAndRetry","_this9","request","endpointURL","ontimeout","resp","_this10","method","accept","XDomainRequest","xdomainRequest","XMLHttpRequest","ActiveXObject","xhrRequest","_this11","onload","parseJSON","responseText","onprogress","_this12","setRequestHeader","onreadystatechange","states","complete","parentKey","queryStr","paramKey","paramVal","serialize","encodeURIComponent","url","prefix","timerCalc","_setTimeout","_this13"],"mappings":"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","file":"app.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/**\n * Module dependencies.\n */\n\nvar Emitter = require('component-emitter')\n\n/**\n * Expose `scene`.\n */\n\nmodule.exports = Application\n\n/**\n * Create a new `Application`.\n *\n * @param {Object} element Optional initial element\n */\n\nfunction Application (element) {\n  if (!(this instanceof Application)) return new Application(element)\n  this.options = {}\n  this.sources = {}\n  this.element = element\n}\n\n/**\n * Mixin `Emitter`.\n */\n\nEmitter(Application.prototype)\n\n/**\n * Add a plugin\n *\n * @param {Function} plugin\n */\n\nApplication.prototype.use = function (plugin) {\n  plugin(this)\n  return this\n}\n\n/**\n * Set an option\n *\n * @param {String} name\n */\n\nApplication.prototype.option = function (name, val) {\n  this.options[name] = val\n  return this\n}\n\n/**\n * Set value used somewhere in the IO network.\n */\n\nApplication.prototype.set = function (name, data) {\n  this.sources[name] = data\n  this.emit('source', name, data)\n  return this\n}\n\n/**\n * Mount a virtual element.\n *\n * @param {VirtualElement} element\n */\n\nApplication.prototype.mount = function (element) {\n  this.element = element\n  this.emit('mount', element)\n  return this\n}\n\n/**\n * Remove the world. Unmount everything.\n */\n\nApplication.prototype.unmount = function () {\n  if (!this.element) return\n  this.element = null\n  this.emit('unmount')\n  return this\n}\n\n},{\"component-emitter\":8}],2:[function(require,module,exports){\n/**\n * All of the events can bind to\n */\n\nmodule.exports = {\n  onBlur: 'blur',\n  onChange: 'change',\n  onClick: 'click',\n  onContextMenu: 'contextmenu',\n  onCopy: 'copy',\n  onCut: 'cut',\n  onDoubleClick: 'dblclick',\n  onDrag: 'drag',\n  onDragEnd: 'dragend',\n  onDragEnter: 'dragenter',\n  onDragExit: 'dragexit',\n  onDragLeave: 'dragleave',\n  onDragOver: 'dragover',\n  onDragStart: 'dragstart',\n  onDrop: 'drop',\n  onFocus: 'focus',\n  onInput: 'input',\n  onInvalid: 'invalid',\n  onKeyDown: 'keydown',\n  onKeyPress: 'keypress',\n  onKeyUp: 'keyup',\n  onMouseDown: 'mousedown',\n  onMouseEnter: 'mouseenter',\n  onMouseLeave: 'mouseleave',\n  onMouseMove: 'mousemove',\n  onMouseOut: 'mouseout',\n  onMouseOver: 'mouseover',\n  onMouseUp: 'mouseup',\n  onPaste: 'paste',\n  onReset: 'reset',\n  onScroll: 'scroll',\n  onSubmit: 'submit',\n  onTouchCancel: 'touchcancel',\n  onTouchEnd: 'touchend',\n  onTouchMove: 'touchmove',\n  onTouchStart: 'touchstart',\n  onWheel: 'wheel'\n}\n\n},{}],3:[function(require,module,exports){\n/**\n * Create the application.\n */\n\nexports.tree =\nexports.scene =\nexports.deku = require('./application')\n\n/**\n * Render scenes to the DOM.\n */\n\nif (typeof document !== 'undefined') {\n  exports.render = require('./render')\n}\n\n/**\n * Render scenes to a string\n */\n\nexports.renderString = require('./stringify')\n},{\"./application\":1,\"./render\":5,\"./stringify\":6}],4:[function(require,module,exports){\nvar type = require('component-type')\n\n/**\n * Returns the type of a virtual node\n *\n * @param  {Object} node\n * @return {String}\n */\n\nmodule.exports = function nodeType (node) {\n  var v = type(node)\n  if (v === 'null' || node === false) return 'empty'\n  if (v !== 'object') return 'text'\n  if (type(node.type) === 'string') return 'element'\n  return 'component'\n}\n\n},{\"component-type\":10}],5:[function(require,module,exports){\n/**\n * Dependencies.\n */\n\nvar raf = require('component-raf')\nvar isDom = require('is-dom')\nvar uid = require('get-uid')\nvar keypath = require('object-path')\nvar events = require('./events')\nvar svg = require('./svg')\nvar defaults = require('object-defaults')\nvar forEach = require('fast.js/forEach')\nvar assign = require('fast.js/object/assign')\nvar reduce = require('fast.js/reduce')\nvar nodeType = require('./node-type')\n\n/**\n * Expose `dom`.\n */\n\nmodule.exports = render\n\n/**\n * Render an app to the DOM\n *\n * @param {Application} app\n * @param {HTMLElement} container\n * @param {Object} opts\n *\n * @return {Object}\n */\n\nfunction render (app, container, opts) {\n  var frameId\n  var isRendering\n  var rootId = 'root'\n  var currentElement\n  var currentNativeElement\n  var connections = {}\n  var components = {}\n  var entities = {}\n  var handlers = {}\n  var mountQueue = []\n  var children = {}\n  children[rootId] = {}\n\n  if (!isDom(container)) {\n    throw new Error('Container element must be a DOM element')\n  }\n\n  /**\n   * Rendering options. Batching is only ever really disabled\n   * when running tests, and pooling can be disabled if the user\n   * is doing something stupid with the DOM in their components.\n   */\n\n  var options = defaults(assign({}, app.options || {}, opts || {}), {\n    batching: true\n  })\n\n  /**\n   * Listen to DOM events\n   */\n  var rootElement = getRootElement(container)\n  addNativeEventListeners()\n\n  /**\n   * Watch for changes to the app so that we can update\n   * the DOM as needed.\n   */\n\n  app.on('unmount', onunmount)\n  app.on('mount', onmount)\n  app.on('source', onupdate)\n\n  /**\n   * If the app has already mounted an element, we can just\n   * render that straight away.\n   */\n\n  if (app.element) render()\n\n  /**\n   * Teardown the DOM rendering so that it stops\n   * rendering and everything can be garbage collected.\n   */\n\n  function teardown () {\n    removeNativeEventListeners()\n    removeNativeElement()\n    app.off('unmount', onunmount)\n    app.off('mount', onmount)\n    app.off('source', onupdate)\n  }\n\n  /**\n   * Swap the current rendered node with a new one that is rendered\n   * from the new virtual element mounted on the app.\n   *\n   * @param {VirtualElement} element\n   */\n\n  function onmount () {\n    invalidate()\n  }\n\n  /**\n   * If the app unmounts an element, we should clear out the current\n   * rendered element. This will remove all the entities.\n   */\n\n  function onunmount () {\n    removeNativeElement()\n    currentElement = null\n  }\n\n  /**\n   * Update all components that are bound to the source\n   *\n   * @param {String} name\n   * @param {*} data\n   */\n\n  function onupdate (name, data) {\n    if (!connections[name]) return;\n    connections[name].forEach(function(update) {\n      update(data)\n    })\n  }\n\n  /**\n   * Render and mount a component to the native dom.\n   *\n   * @param {Entity} entity\n   * @return {HTMLElement}\n   */\n\n  function mountEntity (entity) {\n    register(entity)\n    setSources(entity)\n    children[entity.id] = {}\n    entities[entity.id] = entity\n\n    // commit initial state and props.\n    commit(entity)\n\n    // callback before mounting.\n    trigger('beforeMount', entity, [entity.context])\n    trigger('beforeRender', entity, [entity.context])\n\n    // render virtual element.\n    var virtualElement = renderEntity(entity)\n    // create native element.\n    var nativeElement = toNative(entity.id, '0', virtualElement)\n\n    entity.virtualElement = virtualElement\n    entity.nativeElement = nativeElement\n\n    // Fire afterRender and afterMount hooks at the end\n    // of the render cycle\n    mountQueue.push(entity.id)\n\n    return nativeElement\n  }\n\n  /**\n   * Remove a component from the native dom.\n   *\n   * @param {Entity} entity\n   */\n\n  function unmountEntity (entityId) {\n    var entity = entities[entityId]\n    if (!entity) return\n    trigger('beforeUnmount', entity, [entity.context, entity.nativeElement])\n    unmountChildren(entityId)\n    removeAllEvents(entityId)\n    var componentEntities = components[entityId].entities;\n    delete componentEntities[entityId]\n    delete components[entityId]\n    delete entities[entityId]\n    delete children[entityId]\n  }\n\n  /**\n   * Render the entity and make sure it returns a node\n   *\n   * @param {Entity} entity\n   *\n   * @return {VirtualTree}\n   */\n\n  function renderEntity (entity) {\n    var component = entity.component\n    var fn = typeof component === 'function' ? component : component.render\n    if (!fn) throw new Error('Component needs a render function')\n    var result = fn(entity.context, setState(entity))\n    if (!result) throw new Error('Render function must return an element.')\n    return result\n  }\n\n  /**\n   * Whenever setState or setProps is called, we mark the entity\n   * as dirty in the renderer. This lets us optimize the re-rendering\n   * and skip components that definitely haven't changed.\n   *\n   * @param {Entity} entity\n   *\n   * @return {Function} A curried function for updating the state of an entity\n   */\n\n  function setState (entity) {\n    return function (nextState) {\n      updateEntityState(entity, nextState)\n    }\n  }\n\n  /**\n   * Tell the app it's dirty and needs to re-render. If batching is disabled\n   * we can just trigger a render immediately, otherwise we'll wait until\n   * the next available frame.\n   */\n\n  function invalidate () {\n    if (!options.batching) {\n      if (!isRendering) render()\n    } else {\n      if (!frameId) frameId = raf(render)\n    }\n  }\n\n  /**\n   * Update the DOM. If the update fails we stop the loop\n   * so we don't get errors on every frame.\n   *\n   * @api public\n   */\n\n  function render () {\n    // If this is called synchronously we need to\n    // cancel any pending future updates\n    clearFrame()\n\n    // If the rendering from the previous frame is still going,\n    // we'll just wait until the next frame. Ideally renders should\n    // not take over 16ms to stay within a single frame, but this should\n    // catch it if it does.\n    if (isRendering) {\n      frameId = raf(render)\n      return\n    } else {\n      isRendering = true\n    }\n\n    // 1. If there isn't a native element rendered for the current mounted element\n    // then we need to create it from scratch.\n    // 2. If a new element has been mounted, we should diff them.\n    // 3. We should update check all child components for changes.\n    if (!currentNativeElement) {\n      currentElement = app.element\n      currentNativeElement = toNative(rootId, '0', currentElement)\n      if (container.children.length > 0) {\n        console.info('deku: The container element is not empty. These elements will be removed. Read more: http://cl.ly/b0Sr')\n      }\n      if (container === document.body) {\n        console.warn('deku: Using document.body is allowed but it can cause some issues. Read more: http://cl.ly/b0SC')\n      }\n      removeAllChildren(container)\n      container.appendChild(currentNativeElement)\n    } else if (currentElement !== app.element) {\n      currentNativeElement = patch(rootId, currentElement, app.element, currentNativeElement)\n      currentElement = app.element\n      updateChildren(rootId)\n    } else {\n      updateChildren(rootId)\n    }\n\n    // Call mount events on all new entities\n    flushMountQueue()\n\n    // Allow rendering again.\n    isRendering = false\n\n  }\n\n  /**\n   * Call hooks for all new entities that have been created in\n   * the last render from the bottom up.\n   */\n\n  function flushMountQueue () {\n    while (mountQueue.length > 0) {\n      var entityId = mountQueue.shift()\n      var entity = entities[entityId]\n      trigger('afterRender', entity, [entity.context, entity.nativeElement])\n      trigger('afterMount', entity, [entity.context, entity.nativeElement, setState(entity)])\n    }\n  }\n\n  /**\n   * Clear the current scheduled frame\n   */\n\n  function clearFrame () {\n    if (!frameId) return\n    raf.cancel(frameId)\n    frameId = 0\n  }\n\n  /**\n   * Update a component.\n   *\n   * The entity is just the data object for a component instance.\n   *\n   * @param {String} id Component instance id.\n   */\n\n  function updateEntity (entityId) {\n    var entity = entities[entityId]\n    setSources(entity)\n\n    if (!shouldUpdate(entity)) {\n      commit(entity)\n      return updateChildren(entityId)\n    }\n\n    var currentTree = entity.virtualElement\n    var nextProps = entity.pendingProps\n    var nextState = entity.pendingState\n    var previousState = entity.context.state\n    var previousProps = entity.context.props\n\n    // hook before rendering. could modify state just before the render occurs.\n    trigger('beforeUpdate', entity, [entity.context, nextProps, nextState])\n    trigger('beforeRender', entity, [entity.context])\n\n    // commit state and props.\n    commit(entity)\n\n    // re-render.\n    var nextTree = renderEntity(entity)\n\n    // if the tree is the same we can just skip this component\n    // but we should still check the children to see if they're dirty.\n    // This allows us to memoize the render function of components.\n    if (nextTree === currentTree) return updateChildren(entityId)\n\n    // apply new virtual tree to native dom.\n    entity.nativeElement = patch(entityId, currentTree, nextTree, entity.nativeElement)\n    entity.virtualElement = nextTree\n    updateChildren(entityId)\n\n    // trigger render hook\n    trigger('afterRender', entity, [entity.context, entity.nativeElement])\n\n    // trigger afterUpdate after all children have updated.\n    trigger('afterUpdate', entity, [entity.context, previousProps, previousState, setState(entity)])\n  }\n\n  /**\n   * Update all the children of an entity.\n   *\n   * @param {String} id Component instance id.\n   */\n\n  function updateChildren (entityId) {\n    forEach(children[entityId], function (childId) {\n      updateEntity(childId)\n    })\n  }\n\n  /**\n   * Remove all of the child entities of an entity\n   *\n   * @param {Entity} entity\n   */\n\n  function unmountChildren (entityId) {\n    forEach(children[entityId], function (childId) {\n      unmountEntity(childId)\n    })\n  }\n\n  /**\n   * Remove the root element. If this is called synchronously we need to\n   * cancel any pending future updates.\n   */\n\n  function removeNativeElement () {\n    clearFrame()\n    removeElement(rootId, '0', currentNativeElement)\n    currentNativeElement = null\n  }\n\n  /**\n   * Create a native element from a virtual element.\n   *\n   * @param {String} entityId\n   * @param {String} path\n   * @param {Object} vnode\n   *\n   * @return {HTMLDocumentFragment}\n   */\n\n  function toNative (entityId, path, vnode) {\n    switch (nodeType(vnode)) {\n      case 'text': return toNativeText(vnode)\n      case 'empty': return toNativeEmptyElement(entityId, path)\n      case 'element': return toNativeElement(entityId, path, vnode)\n      case 'component': return toNativeComponent(entityId, path, vnode)\n    }\n  }\n\n  /**\n   * Create a native text element from a virtual element.\n   *\n   * @param {Object} vnode\n   */\n\n  function toNativeText (text) {\n    return document.createTextNode(text)\n  }\n\n  /**\n   * Create a native element from a virtual element.\n   */\n\n  function toNativeElement (entityId, path, vnode) {\n    var el\n    var attributes = vnode.attributes\n    var tagName = vnode.type\n    var childNodes = vnode.children\n\n    // create element either from pool or fresh.\n    if (svg.isElement(tagName)) {\n      el = document.createElementNS(svg.namespace, tagName)\n    } else {\n      el = document.createElement(tagName)\n    }\n\n    // set attributes.\n    forEach(attributes, function (value, name) {\n      setAttribute(entityId, path, el, name, value)\n    })\n\n    // add children.\n    forEach(childNodes, function (child, i) {\n      var childEl = toNative(entityId, path + '.' + i, child)\n      if (!childEl.parentNode) el.appendChild(childEl)\n    })\n\n    // store keys on the native element for fast event handling.\n    el.__entity__ = entityId\n    el.__path__ = path\n\n    return el\n  }\n\n  /**\n   * Create a native element from a virtual element.\n   */\n\n  function toNativeEmptyElement (entityId, path) {\n    var el = document.createElement('noscript')\n    el.__entity__ = entityId\n    el.__path__ = path\n    return el\n  }\n\n  /**\n   * Create a native element from a component.\n   */\n\n  function toNativeComponent (entityId, path, vnode) {\n    var child = new Entity(vnode.type, assign({ children: vnode.children }, vnode.attributes), entityId)\n    children[entityId][path] = child.id\n    return mountEntity(child)\n  }\n\n  /**\n   * Patch an element with the diff from two trees.\n   */\n\n  function patch (entityId, prev, next, el) {\n    return diffNode('0', entityId, prev, next, el)\n  }\n\n  /**\n   * Create a diff between two trees of nodes.\n   */\n\n  function diffNode (path, entityId, prev, next, el) {\n    var leftType = nodeType(prev)\n    var rightType = nodeType(next)\n\n    // Type changed. This could be from element->text, text->ComponentA,\n    // ComponentA->ComponentB etc. But NOT div->span. These are the same type\n    // (ElementNode) but different tag name.\n    if (leftType !== rightType) return replaceElement(entityId, path, el, next)\n\n    switch (rightType) {\n      case 'text': return diffText(prev, next, el)\n      case 'empty': return el\n      case 'element': return diffElement(path, entityId, prev, next, el)\n      case 'component': return diffComponent(path, entityId, prev, next, el)\n    }\n  }\n\n  /**\n   * Diff two text nodes and update the element.\n   */\n\n  function diffText (previous, current, el) {\n    if (current !== previous) el.data = current\n    return el\n  }\n\n  /**\n   * Diff the children of an ElementNode.\n   */\n\n  function diffChildren (path, entityId, prev, next, el) {\n    var positions = []\n    var hasKeys = false\n    var childNodes = Array.prototype.slice.apply(el.childNodes)\n    var leftKeys = reduce(prev.children, keyMapReducer, {})\n    var rightKeys = reduce(next.children, keyMapReducer, {})\n    var currentChildren = assign({}, children[entityId])\n\n    function keyMapReducer (acc, child, i) {\n      if (child && child.attributes && child.attributes.key != null) {\n        acc[child.attributes.key] = {\n          element: child,\n          index: i\n        }\n        hasKeys = true\n      }\n      return acc\n    }\n\n    // Diff all of the nodes that have keys. This lets us re-used elements\n    // instead of overriding them and lets us move them around.\n    if (hasKeys) {\n\n      // Removals\n      forEach(leftKeys, function (leftNode, key) {\n        if (rightKeys[key] == null) {\n          var leftPath = path + '.' + leftNode.index\n          removeElement(\n            entityId,\n            leftPath,\n            childNodes[leftNode.index]\n          )\n        }\n      })\n\n      // Update nodes\n      forEach(rightKeys, function (rightNode, key) {\n        var leftNode = leftKeys[key]\n\n        // We only want updates for now\n        if (leftNode == null) return\n\n        var leftPath = path + '.' + leftNode.index\n\n        // Updated\n        positions[rightNode.index] = diffNode(\n          leftPath,\n          entityId,\n          leftNode.element,\n          rightNode.element,\n          childNodes[leftNode.index]\n        )\n      })\n\n      // Update the positions of all child components and event handlers\n      forEach(rightKeys, function (rightNode, key) {\n        var leftNode = leftKeys[key]\n\n        // We just want elements that have moved around\n        if (leftNode == null || leftNode.index === rightNode.index) return\n\n        var rightPath = path + '.' + rightNode.index\n        var leftPath = path + '.' + leftNode.index\n\n        // Update all the child component path positions to match\n        // the latest positions if they've changed. This is a bit hacky.\n        forEach(currentChildren, function (childId, childPath) {\n          if (leftPath === childPath) {\n            delete children[entityId][childPath]\n            children[entityId][rightPath] = childId\n          }\n        })\n      })\n\n      // Now add all of the new nodes last in case their path\n      // would have conflicted with one of the previous paths.\n      forEach(rightKeys, function (rightNode, key) {\n        var rightPath = path + '.' + rightNode.index\n        if (leftKeys[key] == null) {\n          positions[rightNode.index] = toNative(\n            entityId,\n            rightPath,\n            rightNode.element\n          )\n        }\n      })\n\n    } else {\n      var maxLength = Math.max(prev.children.length, next.children.length)\n\n      // Now diff all of the nodes that don't have keys\n      for (var i = 0; i < maxLength; i++) {\n        var leftNode = prev.children[i]\n        var rightNode = next.children[i]\n\n        // Removals\n        if (rightNode === undefined) {\n          removeElement(\n            entityId,\n            path + '.' + i,\n            childNodes[i]\n          )\n          continue\n        }\n\n        // New Node\n        if (leftNode === undefined) {\n          positions[i] = toNative(\n            entityId,\n            path + '.' + i,\n            rightNode\n          )\n          continue\n        }\n\n        // Updated\n        positions[i] = diffNode(\n          path + '.' + i,\n          entityId,\n          leftNode,\n          rightNode,\n          childNodes[i]\n        )\n      }\n    }\n\n    // Reposition all the elements\n    forEach(positions, function (childEl, newPosition) {\n      var target = el.childNodes[newPosition]\n      if (childEl && childEl !== target) {\n        if (target) {\n          el.insertBefore(childEl, target)\n        } else {\n          el.appendChild(childEl)\n        }\n      }\n    })\n  }\n\n  /**\n   * Diff the attributes and add/remove them.\n   */\n\n  function diffAttributes (prev, next, el, entityId, path) {\n    var nextAttrs = next.attributes\n    var prevAttrs = prev.attributes\n\n    // add new attrs\n    forEach(nextAttrs, function (value, name) {\n      if (events[name] || !(name in prevAttrs) || prevAttrs[name] !== value) {\n        setAttribute(entityId, path, el, name, value)\n      }\n    })\n\n    // remove old attrs\n    forEach(prevAttrs, function (value, name) {\n      if (!(name in nextAttrs)) {\n        removeAttribute(entityId, path, el, name)\n      }\n    })\n  }\n\n  /**\n   * Update a component with the props from the next node. If\n   * the component type has changed, we'll just remove the old one\n   * and replace it with the new component.\n   */\n\n  function diffComponent (path, entityId, prev, next, el) {\n    if (next.type !== prev.type) {\n      return replaceElement(entityId, path, el, next)\n    } else {\n      var targetId = children[entityId][path]\n\n      // This is a hack for now\n      if (targetId) {\n        updateEntityProps(targetId, assign({ children: next.children }, next.attributes))\n      }\n\n      return el\n    }\n  }\n\n  /**\n   * Diff two element nodes.\n   */\n\n  function diffElement (path, entityId, prev, next, el) {\n    if (next.type !== prev.type) return replaceElement(entityId, path, el, next)\n    diffAttributes(prev, next, el, entityId, path)\n    diffChildren(path, entityId, prev, next, el)\n    return el\n  }\n\n  /**\n   * Removes an element from the DOM and unmounts and components\n   * that are within that branch\n   *\n   * side effects:\n   *   - removes element from the DOM\n   *   - removes internal references\n   *\n   * @param {String} entityId\n   * @param {String} path\n   * @param {HTMLElement} el\n   */\n\n  function removeElement (entityId, path, el) {\n    var childrenByPath = children[entityId]\n    var childId = childrenByPath[path]\n    var entityHandlers = handlers[entityId] || {}\n    var removals = []\n\n    // If the path points to a component we should use that\n    // components element instead, because it might have moved it.\n    if (childId) {\n      var child = entities[childId]\n      el = child.nativeElement\n      unmountEntity(childId)\n      removals.push(path)\n    } else {\n\n      // Just remove the text node\n      if (!isElement(el)) return el && el.parentNode.removeChild(el)\n\n      // Then we need to find any components within this\n      // branch and unmount them.\n      forEach(childrenByPath, function (childId, childPath) {\n        if (childPath === path || isWithinPath(path, childPath)) {\n          unmountEntity(childId)\n          removals.push(childPath)\n        }\n      })\n\n      // Remove all events at this path or below it\n      forEach(entityHandlers, function (fn, handlerPath) {\n        if (handlerPath === path || isWithinPath(path, handlerPath)) {\n          removeEvent(entityId, handlerPath)\n        }\n      })\n    }\n\n    // Remove the paths from the object without touching the\n    // old object. This keeps the object using fast properties.\n    forEach(removals, function (path) {\n      delete children[entityId][path]\n    })\n\n    // Remove it from the DOM\n    el.parentNode.removeChild(el)\n  }\n\n  /**\n   * Replace an element in the DOM. Removing all components\n   * within that element and re-rendering the new virtual node.\n   *\n   * @param {Entity} entity\n   * @param {String} path\n   * @param {HTMLElement} el\n   * @param {Object} vnode\n   *\n   * @return {void}\n   */\n\n  function replaceElement (entityId, path, el, vnode) {\n    var parent = el.parentNode\n    var index = Array.prototype.indexOf.call(parent.childNodes, el)\n\n    // remove the previous element and all nested components. This\n    // needs to happen before we create the new element so we don't\n    // get clashes on the component paths.\n    removeElement(entityId, path, el)\n\n    // then add the new element in there\n    var newEl = toNative(entityId, path, vnode)\n    var target = parent.childNodes[index]\n\n    if (target) {\n      parent.insertBefore(newEl, target)\n    } else {\n      parent.appendChild(newEl)\n    }\n\n    // walk up the tree and update all `entity.nativeElement` references.\n    if (entityId !== 'root' && path === '0') {\n      updateNativeElement(entityId, newEl)\n    }\n\n    return newEl\n  }\n\n  /**\n   * Update all entities in a branch that have the same nativeElement. This\n   * happens when a component has another component as it's root node.\n   *\n   * @param {String} entityId\n   * @param {HTMLElement} newEl\n   *\n   * @return {void}\n   */\n\n  function updateNativeElement (entityId, newEl) {\n    var target = entities[entityId]\n    if (target.ownerId === 'root') return\n    if (children[target.ownerId]['0'] === entityId) {\n      entities[target.ownerId].nativeElement = newEl\n      updateNativeElement(target.ownerId, newEl)\n    }\n  }\n\n  /**\n   * Set the attribute of an element, performing additional transformations\n   * dependning on the attribute name\n   *\n   * @param {HTMLElement} el\n   * @param {String} name\n   * @param {String} value\n   */\n\n  function setAttribute (entityId, path, el, name, value) {\n    if (!value) {\n      removeAttribute(entityId, path, el, name)\n      return\n    }\n    if (events[name]) {\n      addEvent(entityId, path, events[name], value)\n      return\n    }\n    switch (name) {\n      case 'checked':\n      case 'disabled':\n      case 'selected':\n        el[name] = true\n        break\n      case 'innerHTML':\n        el.innerHTML = value\n        break\n      case 'value':\n        setElementValue(el, value)\n        break\n      case svg.isAttribute(name):\n        el.setAttributeNS(svg.namespace, name, value)\n        break\n      default:\n        el.setAttribute(name, value)\n        break\n    }\n  }\n\n  /**\n   * Remove an attribute, performing additional transformations\n   * dependning on the attribute name\n   *\n   * @param {HTMLElement} el\n   * @param {String} name\n   */\n\n  function removeAttribute (entityId, path, el, name) {\n    if (events[name]) {\n      removeEvent(entityId, path, events[name])\n      return\n    }\n    switch (name) {\n      case 'checked':\n      case 'disabled':\n      case 'selected':\n        el[name] = false\n        break\n      case 'innerHTML':\n        el.innerHTML = ''\n      case 'value':\n        setElementValue(el, null)\n        break\n      default:\n        el.removeAttribute(name)\n        break\n    }\n  }\n\n  /**\n   * Checks to see if one tree path is within\n   * another tree path. Example:\n   *\n   * 0.1 vs 0.1.1 = true\n   * 0.2 vs 0.3.5 = false\n   *\n   * @param {String} target\n   * @param {String} path\n   *\n   * @return {Boolean}\n   */\n\n  function isWithinPath (target, path) {\n    return path.indexOf(target + '.') === 0\n  }\n\n  /**\n   * Is the DOM node an element node\n   *\n   * @param {HTMLElement} el\n   *\n   * @return {Boolean}\n   */\n\n  function isElement (el) {\n    return !!(el && el.tagName)\n  }\n\n  /**\n   * Remove all the child nodes from an element\n   *\n   * @param {HTMLElement} el\n   */\n\n  function removeAllChildren (el) {\n    while (el.firstChild) el.removeChild(el.firstChild)\n  }\n\n  /**\n   * Trigger a hook on a component.\n   *\n   * @param {String} name Name of hook.\n   * @param {Entity} entity The component instance.\n   * @param {Array} args To pass along to hook.\n   */\n\n  function trigger (name, entity, args) {\n    if (typeof entity.component[name] !== 'function') return\n    return entity.component[name].apply(null, args)\n  }\n\n  /**\n   * Update an entity to match the latest rendered vode. We always\n   * replace the props on the component when composing them. This\n   * will trigger a re-render on all children below this point.\n   *\n   * @param {Entity} entity\n   * @param {String} path\n   * @param {Object} vnode\n   *\n   * @return {void}\n   */\n\n  function updateEntityProps (entityId, nextProps) {\n    var entity = entities[entityId]\n    entity.pendingProps = defaults({}, nextProps, entity.component.defaultProps || {})\n    entity.dirty = true\n    invalidate()\n  }\n\n  /**\n   * Update component instance state.\n   */\n\n  function updateEntityState (entity, nextState) {\n    entity.pendingState = assign(entity.pendingState, nextState)\n    entity.dirty = true\n    invalidate()\n  }\n\n  /**\n   * Commit props and state changes to an entity.\n   */\n\n  function commit (entity) {\n    entity.context = {\n      state: entity.pendingState,\n      props: entity.pendingProps,\n      id: entity.id\n    }\n    entity.pendingState = assign({}, entity.context.state)\n    entity.pendingProps = assign({}, entity.context.props)\n    entity.dirty = false\n    if (typeof entity.component.validate === 'function') {\n      entity.component.validate(entity.context)\n    }\n  }\n\n  /**\n   * Try to avoid creating new virtual dom if possible.\n   *\n   * Later we may expose this so you can override, but not there yet.\n   */\n\n  function shouldUpdate (entity) {\n    if (!entity.dirty) return false\n    if (!entity.component.shouldUpdate) return true\n    var nextProps = entity.pendingProps\n    var nextState = entity.pendingState\n    var bool = entity.component.shouldUpdate(entity.context, nextProps, nextState)\n    return bool\n  }\n\n  /**\n   * Register an entity.\n   *\n   * This is mostly to pre-preprocess component properties and values chains.\n   *\n   * The end result is for every component that gets mounted,\n   * you create a set of IO nodes in the network from the `value` definitions.\n   *\n   * @param {Component} component\n   */\n\n  function register (entity) {\n    registerEntity(entity)\n    var component = entity.component\n    if (component.registered) return\n\n    // initialize sources once for a component type.\n    registerSources(entity)\n    component.registered = true\n  }\n\n  /**\n   * Add entity to data-structures related to components/entities.\n   *\n   * @param {Entity} entity\n   */\n\n  function registerEntity(entity) {\n    var component = entity.component\n    // all entities for this component type.\n    var entities = component.entities = component.entities || {}\n    // add entity to component list\n    entities[entity.id] = entity\n    // map to component so you can remove later.\n    components[entity.id] = component\n  }\n\n  /**\n   * Initialize sources for a component by type.\n   *\n   * @param {Entity} entity\n   */\n\n  function registerSources(entity) {\n    var component = components[entity.id]\n    // get 'class-level' sources.\n    // if we've already hooked it up, then we're good.\n    var sources = component.sources\n    if (sources) return\n    var entities = component.entities\n\n    // hook up sources.\n    var map = component.sourceToPropertyName = {}\n    component.sources = sources = []\n    var propTypes = component.propTypes\n    for (var name in propTypes) {\n      var data = propTypes[name]\n      if (!data) continue\n      if (!data.source) continue\n      sources.push(data.source)\n      map[data.source] = name\n    }\n\n    // send value updates to all component instances.\n    sources.forEach(function (source) {\n      connections[source] = connections[source] || []\n      connections[source].push(update)\n\n      function update (data) {\n        var prop = map[source]\n        for (var entityId in entities) {\n          var entity = entities[entityId]\n          var changes = {}\n          changes[prop] = data\n          updateEntityProps(entityId, assign(entity.pendingProps, changes))\n        }\n      }\n    })\n  }\n\n  /**\n   * Set the initial source value on the entity\n   *\n   * @param {Entity} entity\n   */\n\n  function setSources (entity) {\n    var component = entity.component\n    var map = component.sourceToPropertyName\n    var sources = component.sources\n    sources.forEach(function (source) {\n      var name = map[source]\n      if (entity.pendingProps[name] != null) return\n      entity.pendingProps[name] = app.sources[source] // get latest value plugged into global store\n    })\n  }\n\n  /**\n   * Add all of the DOM event listeners\n   */\n\n  function addNativeEventListeners () {\n    forEach(events, function (eventType) {\n      rootElement.addEventListener(eventType, handleEvent, true)\n    })\n  }\n\n  /**\n   * Add all of the DOM event listeners\n   */\n\n  function removeNativeEventListeners () {\n    forEach(events, function (eventType) {\n      rootElement.removeEventListener(eventType, handleEvent, true)\n    })\n  }\n\n  /**\n   * Handle an event that has occured within the container\n   *\n   * @param {Event} event\n   */\n\n  function handleEvent (event) {\n    var target = event.target\n    var eventType = event.type\n\n    // Walk up the DOM tree and see if there is a handler\n    // for this event type higher up.\n    while (target) {\n      var fn = keypath.get(handlers, [target.__entity__, target.__path__, eventType])\n      if (fn) {\n        event.delegateTarget = target\n        if (fn(event) === false) break\n      }\n      target = target.parentNode\n    }\n  }\n\n  /**\n   * Bind events for an element, and all it's rendered child elements.\n   *\n   * @param {String} path\n   * @param {String} event\n   * @param {Function} fn\n   */\n\n  function addEvent (entityId, path, eventType, fn) {\n    keypath.set(handlers, [entityId, path, eventType], function (e) {\n      var entity = entities[entityId]\n      if (entity) {\n        fn.call(null, e, entity.context, setState(entity))\n      } else {\n        fn.call(null, e)\n      }\n    })\n  }\n\n  /**\n   * Unbind events for a entityId\n   *\n   * @param {String} entityId\n   */\n\n  function removeEvent (entityId, path, eventType) {\n    var args = [entityId]\n    if (path) args.push(path)\n    if (eventType) args.push(eventType)\n    keypath.del(handlers, args)\n  }\n\n  /**\n   * Unbind all events from an entity\n   *\n   * @param {Entity} entity\n   */\n\n  function removeAllEvents (entityId) {\n    keypath.del(handlers, [entityId])\n  }\n\n  /**\n   * Used for debugging to inspect the current state without\n   * us needing to explicitly manage storing/updating references.\n   *\n   * @return {Object}\n   */\n\n  function inspect () {\n    return {\n      entities: entities,\n      handlers: handlers,\n      connections: connections,\n      currentElement: currentElement,\n      options: options,\n      app: app,\n      container: container,\n      children: children\n    }\n  }\n\n  /**\n   * Return an object that lets us completely remove the automatic\n   * DOM rendering and export debugging tools.\n   */\n\n  return {\n    remove: teardown,\n    inspect: inspect\n  }\n}\n\n/**\n * A rendered component instance.\n *\n * This manages the lifecycle, props and state of the component.\n * It's basically just a data object for more straightfoward lookup.\n *\n * @param {Component} component\n * @param {Object} props\n */\n\nfunction Entity (component, props, ownerId) {\n  this.id = uid()\n  this.ownerId = ownerId\n  this.component = component\n  this.propTypes = component.propTypes || {}\n  this.context = {}\n  this.context.id = this.id\n  this.context.props = defaults(props || {}, component.defaultProps || {})\n  this.context.state = this.component.initialState ? this.component.initialState(this.context.props) : {}\n  this.pendingProps = assign({}, this.context.props)\n  this.pendingState = assign({}, this.context.state)\n  this.dirty = false\n  this.virtualElement = null\n  this.nativeElement = null\n  this.displayName = component.name || 'Component'\n}\n\n/**\n * Retrieve the nearest 'body' ancestor of the given element or else the root\n * element of the document in which stands the given element.\n *\n * This is necessary if you want to attach the events handler to the correct\n * element and be able to dispatch events in document fragments such as\n * Shadow DOM.\n *\n * @param  {HTMLElement} el The element on which we will render an app.\n * @return {HTMLElement}    The root element on which we will attach the events\n *                          handler.\n */\n\nfunction getRootElement (el) {\n  while (el.parentElement) {\n    if (el.tagName === 'BODY' || !el.parentElement) {\n      return el\n    }\n    el = el.parentElement\n  }\n  return el\n}\n\n/**\n * Set the value property of an element and keep the text selection\n * for input fields.\n *\n * @param {HTMLElement} el\n * @param {String} value\n */\n\nfunction setElementValue (el, value) {\n  if (el.tagName !== 'INPUT') {\n    el.value = value\n    return\n  }\n  var start = el.selectionStart\n  var end = el.selectionEnd\n  el.value = value\n  el.setSelectionRange(start, end)\n}\n},{\"./events\":2,\"./node-type\":4,\"./svg\":7,\"component-raf\":9,\"fast.js/forEach\":13,\"fast.js/object/assign\":16,\"fast.js/reduce\":19,\"get-uid\":20,\"is-dom\":21,\"object-defaults\":24,\"object-path\":25}],6:[function(require,module,exports){\nvar defaults = require('object-defaults')\nvar nodeType = require('./node-type')\nvar type = require('component-type')\n\n/**\n * Expose `stringify`.\n */\n\nmodule.exports = function (app) {\n  if (!app.element) {\n    throw new Error('No element mounted')\n  }\n\n  /**\n   * Render to string.\n   *\n   * @param {Component} component\n   * @param {Object} [props]\n   * @return {String}\n   */\n\n  function stringify (component, optProps) {\n    var propTypes = component.propTypes || {}\n    var props = defaults(optProps || {}, component.defaultProps || {})\n    var state = component.initialState ? component.initialState(props) : {}\n\n    for (var name in propTypes) {\n      var options = propTypes[name]\n      if (options.source) {\n        props[name] = app.sources[options.source]\n      }\n    }\n\n    if (component.beforeMount) component.beforeMount({ props: props, state: state })\n    if (component.beforeRender) component.beforeRender({ props: props, state: state })\n    var node = component.render({ props: props, state: state })\n    return stringifyNode(node, '0')\n  }\n\n  /**\n   * Render a node to a string\n   *\n   * @param {Node} node\n   * @param {Tree} tree\n   *\n   * @return {String}\n   */\n\n  function stringifyNode (node, path) {\n    switch (nodeType(node)) {\n      case 'empty': return '<noscript />'\n      case 'text': return node\n      case 'element':\n        var children = node.children\n        var attributes = node.attributes\n        var tagName = node.type\n        var innerHTML = attributes.innerHTML\n        var str = '<' + tagName + attrs(attributes) + '>'\n\n        if (innerHTML) {\n          str += innerHTML\n        } else {\n          for (var i = 0, n = children.length; i < n; i++) {\n            str += stringifyNode(children[i], path + '.' + i)\n          }\n        }\n\n        str += '</' + tagName + '>'\n        return str\n      case 'component': return stringify(node.type, node.attributes)\n    }\n\n    throw new Error('Invalid type')\n  }\n\n  return stringifyNode(app.element, '0')\n}\n\n/**\n * HTML attributes to string.\n *\n * @param {Object} attributes\n * @return {String}\n * @api private\n */\n\nfunction attrs (attributes) {\n  var str = ''\n  for (var key in attributes) {\n    var value = attributes[key]\n    if (key === 'innerHTML') continue\n    if (isValidAttributeValue(value)) str += attr(key, attributes[key])\n  }\n  return str\n}\n\n/**\n * HTML attribute to string.\n *\n * @param {String} key\n * @param {String} val\n * @return {String}\n * @api private\n */\n\nfunction attr (key, val) {\n  return ' ' + key + '=\"' + val + '\"'\n}\n\n/**\n * Is a value able to be set a an attribute value?\n *\n * @param {Any} value\n *\n * @return {Boolean}\n */\n\nfunction isValidAttributeValue (value) {\n  var valueType = type(value)\n  return (valueType === 'string' || valueType === 'boolean' || valueType === 'number')\n}\n\n},{\"./node-type\":4,\"component-type\":10,\"object-defaults\":24}],7:[function(require,module,exports){\nmodule.exports = {\n  isElement: require('is-svg-element').isElement,\n  isAttribute: require('is-svg-attribute'),\n  namespace: 'http://www.w3.org/2000/svg'\n}\n\n},{\"is-svg-attribute\":22,\"is-svg-element\":23}],8:[function(require,module,exports){\n\n/**\n * Expose `Emitter`.\n */\n\nmodule.exports = Emitter;\n\n/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nfunction Emitter(obj) {\n  if (obj) return mixin(obj);\n};\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n  var args = [].slice.call(arguments, 1)\n    , callbacks = this._callbacks['$' + event];\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n\n},{}],9:[function(require,module,exports){\n/**\n * Expose `requestAnimationFrame()`.\n */\n\nexports = module.exports = window.requestAnimationFrame\n  || window.webkitRequestAnimationFrame\n  || window.mozRequestAnimationFrame\n  || fallback;\n\n/**\n * Fallback implementation.\n */\n\nvar prev = new Date().getTime();\nfunction fallback(fn) {\n  var curr = new Date().getTime();\n  var ms = Math.max(0, 16 - (curr - prev));\n  var req = setTimeout(fn, ms);\n  prev = curr;\n  return req;\n}\n\n/**\n * Cancel.\n */\n\nvar cancel = window.cancelAnimationFrame\n  || window.webkitCancelAnimationFrame\n  || window.mozCancelAnimationFrame\n  || window.clearTimeout;\n\nexports.cancel = function(id){\n  cancel.call(window, id);\n};\n\n},{}],10:[function(require,module,exports){\n/**\n * toString ref.\n */\n\nvar toString = Object.prototype.toString;\n\n/**\n * Return the type of `val`.\n *\n * @param {Mixed} val\n * @return {String}\n * @api public\n */\n\nmodule.exports = function(val){\n  switch (toString.call(val)) {\n    case '[object Date]': return 'date';\n    case '[object RegExp]': return 'regexp';\n    case '[object Arguments]': return 'arguments';\n    case '[object Array]': return 'array';\n    case '[object Error]': return 'error';\n  }\n\n  if (val === null) return 'null';\n  if (val === undefined) return 'undefined';\n  if (val !== val) return 'nan';\n  if (val && val.nodeType === 1) return 'element';\n\n  val = val.valueOf\n    ? val.valueOf()\n    : Object.prototype.valueOf.apply(val)\n\n  return typeof val;\n};\n\n},{}],11:[function(require,module,exports){\n'use strict';\n\nvar bindInternal3 = require('../function/bindInternal3');\n\n/**\n * # For Each\n *\n * A fast `.forEach()` implementation.\n *\n * @param  {Array}    subject     The array (or array-like) to iterate over.\n * @param  {Function} fn          The visitor function.\n * @param  {Object}   thisContext The context for the visitor.\n */\nmodule.exports = function fastForEach (subject, fn, thisContext) {\n  var length = subject.length,\n      iterator = thisContext !== undefined ? bindInternal3(fn, thisContext) : fn,\n      i;\n  for (i = 0; i < length; i++) {\n    iterator(subject[i], i, subject);\n  }\n};\n\n},{\"../function/bindInternal3\":14}],12:[function(require,module,exports){\n'use strict';\n\nvar bindInternal4 = require('../function/bindInternal4');\n\n/**\n * # Reduce\n *\n * A fast `.reduce()` implementation.\n *\n * @param  {Array}    subject      The array (or array-like) to reduce.\n * @param  {Function} fn           The reducer function.\n * @param  {mixed}    initialValue The initial value for the reducer, defaults to subject[0].\n * @param  {Object}   thisContext  The context for the reducer.\n * @return {mixed}                 The final result.\n */\nmodule.exports = function fastReduce (subject, fn, initialValue, thisContext) {\n  var length = subject.length,\n      iterator = thisContext !== undefined ? bindInternal4(fn, thisContext) : fn,\n      i, result;\n\n  if (initialValue === undefined) {\n    i = 1;\n    result = subject[0];\n  }\n  else {\n    i = 0;\n    result = initialValue;\n  }\n\n  for (; i < length; i++) {\n    result = iterator(result, subject[i], i, subject);\n  }\n\n  return result;\n};\n\n},{\"../function/bindInternal4\":15}],13:[function(require,module,exports){\n'use strict';\n\nvar forEachArray = require('./array/forEach'),\n    forEachObject = require('./object/forEach');\n\n/**\n * # ForEach\n *\n * A fast `.forEach()` implementation.\n *\n * @param  {Array|Object} subject     The array or object to iterate over.\n * @param  {Function}     fn          The visitor function.\n * @param  {Object}       thisContext The context for the visitor.\n */\nmodule.exports = function fastForEach (subject, fn, thisContext) {\n  if (subject instanceof Array) {\n    return forEachArray(subject, fn, thisContext);\n  }\n  else {\n    return forEachObject(subject, fn, thisContext);\n  }\n};\n},{\"./array/forEach\":11,\"./object/forEach\":17}],14:[function(require,module,exports){\n'use strict';\n\n/**\n * Internal helper to bind a function known to have 3 arguments\n * to a given context.\n */\nmodule.exports = function bindInternal3 (func, thisContext) {\n  return function (a, b, c) {\n    return func.call(thisContext, a, b, c);\n  };\n};\n\n},{}],15:[function(require,module,exports){\n'use strict';\n\n/**\n * Internal helper to bind a function known to have 4 arguments\n * to a given context.\n */\nmodule.exports = function bindInternal4 (func, thisContext) {\n  return function (a, b, c, d) {\n    return func.call(thisContext, a, b, c, d);\n  };\n};\n\n},{}],16:[function(require,module,exports){\n'use strict';\n\n/**\n * Analogue of Object.assign().\n * Copies properties from one or more source objects to\n * a target object. Existing keys on the target object will be overwritten.\n *\n * > Note: This differs from spec in some important ways:\n * > 1. Will throw if passed non-objects, including `undefined` or `null` values.\n * > 2. Does not support the curious Exception handling behavior, exceptions are thrown immediately.\n * > For more details, see:\n * > https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign\n *\n *\n *\n * @param  {Object} target      The target object to copy properties to.\n * @param  {Object} source, ... The source(s) to copy properties from.\n * @return {Object}             The updated target object.\n */\nmodule.exports = function fastAssign (target) {\n  var totalArgs = arguments.length,\n      source, i, totalKeys, keys, key, j;\n\n  for (i = 1; i < totalArgs; i++) {\n    source = arguments[i];\n    keys = Object.keys(source);\n    totalKeys = keys.length;\n    for (j = 0; j < totalKeys; j++) {\n      key = keys[j];\n      target[key] = source[key];\n    }\n  }\n  return target;\n};\n\n},{}],17:[function(require,module,exports){\n'use strict';\n\nvar bindInternal3 = require('../function/bindInternal3');\n\n/**\n * # For Each\n *\n * A fast object `.forEach()` implementation.\n *\n * @param  {Object}   subject     The object to iterate over.\n * @param  {Function} fn          The visitor function.\n * @param  {Object}   thisContext The context for the visitor.\n */\nmodule.exports = function fastForEachObject (subject, fn, thisContext) {\n  var keys = Object.keys(subject),\n      length = keys.length,\n      iterator = thisContext !== undefined ? bindInternal3(fn, thisContext) : fn,\n      key, i;\n  for (i = 0; i < length; i++) {\n    key = keys[i];\n    iterator(subject[key], key, subject);\n  }\n};\n\n},{\"../function/bindInternal3\":14}],18:[function(require,module,exports){\n'use strict';\n\nvar bindInternal4 = require('../function/bindInternal4');\n\n/**\n * # Reduce\n *\n * A fast object `.reduce()` implementation.\n *\n * @param  {Object}   subject      The object to reduce over.\n * @param  {Function} fn           The reducer function.\n * @param  {mixed}    initialValue The initial value for the reducer, defaults to subject[0].\n * @param  {Object}   thisContext  The context for the reducer.\n * @return {mixed}                 The final result.\n */\nmodule.exports = function fastReduceObject (subject, fn, initialValue, thisContext) {\n  var keys = Object.keys(subject),\n      length = keys.length,\n      iterator = thisContext !== undefined ? bindInternal4(fn, thisContext) : fn,\n      i, key, result;\n\n  if (initialValue === undefined) {\n    i = 1;\n    result = subject[keys[0]];\n  }\n  else {\n    i = 0;\n    result = initialValue;\n  }\n\n  for (; i < length; i++) {\n    key = keys[i];\n    result = iterator(result, subject[key], key, subject);\n  }\n\n  return result;\n};\n\n},{\"../function/bindInternal4\":15}],19:[function(require,module,exports){\n'use strict';\n\nvar reduceArray = require('./array/reduce'),\n    reduceObject = require('./object/reduce');\n\n/**\n * # Reduce\n *\n * A fast `.reduce()` implementation.\n *\n * @param  {Array|Object} subject      The array or object to reduce over.\n * @param  {Function}     fn           The reducer function.\n * @param  {mixed}        initialValue The initial value for the reducer, defaults to subject[0].\n * @param  {Object}       thisContext  The context for the reducer.\n * @return {Array|Object}              The array or object containing the results.\n */\nmodule.exports = function fastReduce (subject, fn, initialValue, thisContext) {\n  if (subject instanceof Array) {\n    return reduceArray(subject, fn, initialValue, thisContext);\n  }\n  else {\n    return reduceObject(subject, fn, initialValue, thisContext);\n  }\n};\n},{\"./array/reduce\":12,\"./object/reduce\":18}],20:[function(require,module,exports){\n/** generate unique id for selector */\r\nvar counter = Date.now() % 1e9;\r\n\r\nmodule.exports = function getUid(){\r\n\treturn (Math.random() * 1e9 >>> 0) + (counter++);\r\n};\n},{}],21:[function(require,module,exports){\n/*global window*/\n\n/**\n * Check if object is dom node.\n *\n * @param {Object} val\n * @return {Boolean}\n * @api public\n */\n\nmodule.exports = function isNode(val){\n  if (!val || typeof val !== 'object') return false;\n  if (window && 'object' == typeof window.Node) return val instanceof window.Node;\n  return 'number' == typeof val.nodeType && 'string' == typeof val.nodeName;\n}\n\n},{}],22:[function(require,module,exports){\n/**\n * Supported SVG attributes\n */\n\nexports.attributes = {\n  'cx': true,\n  'cy': true,\n  'd': true,\n  'dx': true,\n  'dy': true,\n  'fill': true,\n  'fillOpacity': true,\n  'fontFamily': true,\n  'fontSize': true,\n  'fx': true,\n  'fy': true,\n  'gradientTransform': true,\n  'gradientUnits': true,\n  'markerEnd': true,\n  'markerMid': true,\n  'markerStart': true,\n  'offset': true,\n  'opacity': true,\n  'patternContentUnits': true,\n  'patternUnits': true,\n  'points': true,\n  'preserveAspectRatio': true,\n  'r': true,\n  'rx': true,\n  'ry': true,\n  'spreadMethod': true,\n  'stopColor': true,\n  'stopOpacity': true,\n  'stroke': true,\n  'strokeDasharray': true,\n  'strokeLinecap': true,\n  'strokeOpacity': true,\n  'strokeWidth': true,\n  'textAnchor': true,\n  'transform': true,\n  'version': true,\n  'viewBox': true,\n  'x1': true,\n  'x2': true,\n  'x': true,\n  'y1': true,\n  'y2': true,\n  'y': true\n}\n\n/**\n * Are element's attributes SVG?\n *\n * @param {String} attr\n */\n\nmodule.exports = function (attr) {\n  return attr in exports.attributes\n}\n\n},{}],23:[function(require,module,exports){\n/**\n * Supported SVG elements\n *\n * @type {Array}\n */\n\nexports.elements = {\n  'animate': true,\n  'circle': true,\n  'defs': true,\n  'ellipse': true,\n  'g': true,\n  'line': true,\n  'linearGradient': true,\n  'mask': true,\n  'path': true,\n  'pattern': true,\n  'polygon': true,\n  'polyline': true,\n  'radialGradient': true,\n  'rect': true,\n  'stop': true,\n  'svg': true,\n  'text': true,\n  'tspan': true\n}\n\n/**\n * Is element's namespace SVG?\n *\n * @param {String} name\n */\n\nexports.isElement = function (name) {\n  return name in exports.elements\n}\n\n},{}],24:[function(require,module,exports){\n'use strict'\n\nmodule.exports = function(target) {\n  target = target || {}\n\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i]\n    if (!source) continue\n\n    Object.getOwnPropertyNames(source).forEach(function(key) {\n      if (undefined === target[key])\n        target[key] = source[key]\n    })\n  }\n\n  return target\n}\n\n},{}],25:[function(require,module,exports){\n(function (root, factory){\n  'use strict';\n\n  /*istanbul ignore next:cant test*/\n  if (typeof module === 'object' && typeof module.exports === 'object') {\n    module.exports = factory();\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], factory);\n  } else {\n    // Browser globals\n    root.objectPath = factory();\n  }\n})(this, function(){\n  'use strict';\n\n  var\n    toStr = Object.prototype.toString,\n    _hasOwnProperty = Object.prototype.hasOwnProperty;\n\n  function isEmpty(value){\n    if (!value) {\n      return true;\n    }\n    if (isArray(value) && value.length === 0) {\n        return true;\n    } else if (!isString(value)) {\n        for (var i in value) {\n            if (_hasOwnProperty.call(value, i)) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n  }\n\n  function toString(type){\n    return toStr.call(type);\n  }\n\n  function isNumber(value){\n    return typeof value === 'number' || toString(value) === \"[object Number]\";\n  }\n\n  function isString(obj){\n    return typeof obj === 'string' || toString(obj) === \"[object String]\";\n  }\n\n  function isObject(obj){\n    return typeof obj === 'object' && toString(obj) === \"[object Object]\";\n  }\n\n  function isArray(obj){\n    return typeof obj === 'object' && typeof obj.length === 'number' && toString(obj) === '[object Array]';\n  }\n\n  function isBoolean(obj){\n    return typeof obj === 'boolean' || toString(obj) === '[object Boolean]';\n  }\n\n  function getKey(key){\n    var intKey = parseInt(key);\n    if (intKey.toString() === key) {\n      return intKey;\n    }\n    return key;\n  }\n\n  function set(obj, path, value, doNotReplace){\n    if (isNumber(path)) {\n      path = [path];\n    }\n    if (isEmpty(path)) {\n      return obj;\n    }\n    if (isString(path)) {\n      return set(obj, path.split('.').map(getKey), value, doNotReplace);\n    }\n    var currentPath = path[0];\n\n    if (path.length === 1) {\n      var oldVal = obj[currentPath];\n      if (oldVal === void 0 || !doNotReplace) {\n        obj[currentPath] = value;\n      }\n      return oldVal;\n    }\n\n    if (obj[currentPath] === void 0) {\n      //check if we assume an array\n      if(isNumber(path[1])) {\n        obj[currentPath] = [];\n      } else {\n        obj[currentPath] = {};\n      }\n    }\n\n    return set(obj[currentPath], path.slice(1), value, doNotReplace);\n  }\n\n  function del(obj, path) {\n    if (isNumber(path)) {\n      path = [path];\n    }\n\n    if (isEmpty(obj)) {\n      return void 0;\n    }\n\n    if (isEmpty(path)) {\n      return obj;\n    }\n    if(isString(path)) {\n      return del(obj, path.split('.'));\n    }\n\n    var currentPath = getKey(path[0]);\n    var oldVal = obj[currentPath];\n\n    if(path.length === 1) {\n      if (oldVal !== void 0) {\n        if (isArray(obj)) {\n          obj.splice(currentPath, 1);\n        } else {\n          delete obj[currentPath];\n        }\n      }\n    } else {\n      if (obj[currentPath] !== void 0) {\n        return del(obj[currentPath], path.slice(1));\n      }\n    }\n\n    return obj;\n  }\n\n  var objectPath = function(obj) {\n    return Object.keys(objectPath).reduce(function(proxy, prop) {\n      if (typeof objectPath[prop] === 'function') {\n        proxy[prop] = objectPath[prop].bind(objectPath, obj);\n      }\n\n      return proxy;\n    }, {});\n  };\n\n  objectPath.has = function (obj, path) {\n    if (isEmpty(obj)) {\n      return false;\n    }\n\n    if (isNumber(path)) {\n      path = [path];\n    } else if (isString(path)) {\n      path = path.split('.');\n    }\n\n    if (isEmpty(path) || path.length === 0) {\n      return false;\n    }\n\n    for (var i = 0; i < path.length; i++) {\n      var j = path[i];\n      if ((isObject(obj) || isArray(obj)) && _hasOwnProperty.call(obj, j)) {\n        obj = obj[j];\n      } else {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  objectPath.ensureExists = function (obj, path, value){\n    return set(obj, path, value, true);\n  };\n\n  objectPath.set = function (obj, path, value, doNotReplace){\n    return set(obj, path, value, doNotReplace);\n  };\n\n  objectPath.insert = function (obj, path, value, at){\n    var arr = objectPath.get(obj, path);\n    at = ~~at;\n    if (!isArray(arr)) {\n      arr = [];\n      objectPath.set(obj, path, arr);\n    }\n    arr.splice(at, 0, value);\n  };\n\n  objectPath.empty = function(obj, path) {\n    if (isEmpty(path)) {\n      return obj;\n    }\n    if (isEmpty(obj)) {\n      return void 0;\n    }\n\n    var value, i;\n    if (!(value = objectPath.get(obj, path))) {\n      return obj;\n    }\n\n    if (isString(value)) {\n      return objectPath.set(obj, path, '');\n    } else if (isBoolean(value)) {\n      return objectPath.set(obj, path, false);\n    } else if (isNumber(value)) {\n      return objectPath.set(obj, path, 0);\n    } else if (isArray(value)) {\n      value.length = 0;\n    } else if (isObject(value)) {\n      for (i in value) {\n        if (_hasOwnProperty.call(value, i)) {\n          delete value[i];\n        }\n      }\n    } else {\n      return objectPath.set(obj, path, null);\n    }\n  };\n\n  objectPath.push = function (obj, path /*, values */){\n    var arr = objectPath.get(obj, path);\n    if (!isArray(arr)) {\n      arr = [];\n      objectPath.set(obj, path, arr);\n    }\n\n    arr.push.apply(arr, Array.prototype.slice.call(arguments, 2));\n  };\n\n  objectPath.coalesce = function (obj, paths, defaultValue) {\n    var value;\n\n    for (var i = 0, len = paths.length; i < len; i++) {\n      if ((value = objectPath.get(obj, paths[i])) !== void 0) {\n        return value;\n      }\n    }\n\n    return defaultValue;\n  };\n\n  objectPath.get = function (obj, path, defaultValue){\n    if (isNumber(path)) {\n      path = [path];\n    }\n    if (isEmpty(path)) {\n      return obj;\n    }\n    if (isEmpty(obj)) {\n      return defaultValue;\n    }\n    if (isString(path)) {\n      return objectPath.get(obj, path.split('.'), defaultValue);\n    }\n\n    var currentPath = getKey(path[0]);\n\n    if (path.length === 1) {\n      if (obj[currentPath] === void 0) {\n        return defaultValue;\n      }\n      return obj[currentPath];\n    }\n\n    return objectPath.get(obj[currentPath], path.slice(1), defaultValue);\n  };\n\n  objectPath.del = function(obj, path) {\n    return del(obj, path);\n  };\n\n  return objectPath;\n});\n\n},{}],26:[function(require,module,exports){\n/**\n * Module dependencies.\n */\n\nvar slice = require('sliced')\nvar flatten = require('array-flatten')\n\n/**\n * This function lets us create virtual nodes using a simple\n * syntax. It is compatible with JSX transforms so you can use\n * JSX to write nodes that will compile to this function.\n *\n * let node = element('div', { id: 'foo' }, [\n *   element('a', { href: 'http://google.com' }, 'Google')\n * ])\n *\n * You can leave out the attributes or the children if either\n * of them aren't needed and it will figure out what you're\n * trying to do.\n */\n\nmodule.exports = element\n\n/**\n * Create virtual trees of components.\n *\n * This creates the nicer API for the user.\n * It translates that friendly API into an actual tree of nodes.\n *\n * @param {*} type\n * @param {Object} attributes\n * @param {Array} children\n * @return {Object}\n * @api public\n */\n\nfunction element (type, attributes, children) {\n  // Default to div with no args\n  if (!type) {\n    throw new TypeError('element() needs a type.')\n  }\n\n  // Skipped adding attributes and we're passing\n  // in children instead.\n  if (arguments.length === 2 && (typeof attributes === 'string' || Array.isArray(attributes))) {\n    children = attributes\n    attributes = {}\n  }\n\n  // Account for JSX putting the children as multiple arguments.\n  // This is essentially just the ES6 rest param\n  if (arguments.length > 2 && Array.isArray(arguments[2]) === false) {\n    children = slice(arguments, 2)\n  }\n\n  children = children || []\n  attributes = attributes || {}\n\n  // passing in a single child, you can skip\n  // using the array\n  if (!Array.isArray(children)) {\n    children = [children]\n  }\n\n  // Flatten nested child arrays. This is how JSX compiles some nodes.\n  children = flatten(children, 2)\n\n  // if you pass in a function, it's a `Component` constructor.\n  // otherwise it's an element.\n  return {\n    type: type,\n    children: children,\n    attributes: attributes\n  }\n}\n\n},{\"array-flatten\":27,\"sliced\":28}],27:[function(require,module,exports){\n'use strict'\n\n/**\n * Expose `arrayFlatten`.\n */\nmodule.exports = arrayFlatten\n\n/**\n * Recursive flatten function with depth.\n *\n * @param  {Array}  array\n * @param  {Array}  result\n * @param  {Number} depth\n * @return {Array}\n */\nfunction flattenWithDepth (array, result, depth) {\n  for (var i = 0; i < array.length; i++) {\n    var value = array[i]\n\n    if (depth > 0 && Array.isArray(value)) {\n      flattenWithDepth(value, result, depth - 1)\n    } else {\n      result.push(value)\n    }\n  }\n\n  return result\n}\n\n/**\n * Recursive flatten function. Omitting depth is slightly faster.\n *\n * @param  {Array} array\n * @param  {Array} result\n * @return {Array}\n */\nfunction flattenForever (array, result) {\n  for (var i = 0; i < array.length; i++) {\n    var value = array[i]\n\n    if (Array.isArray(value)) {\n      flattenForever(value, result)\n    } else {\n      result.push(value)\n    }\n  }\n\n  return result\n}\n\n/**\n * Flatten an array, with the ability to define a depth.\n *\n * @param  {Array}  array\n * @param  {Number} depth\n * @return {Array}\n */\nfunction arrayFlatten (array, depth) {\n  if (depth == null) {\n    return flattenForever(array, [])\n  }\n\n  return flattenWithDepth(array, [], depth)\n}\n\n},{}],28:[function(require,module,exports){\nmodule.exports = exports = require('./lib/sliced');\n\n},{\"./lib/sliced\":29}],29:[function(require,module,exports){\n\n/**\n * An Array.prototype.slice.call(arguments) alternative\n *\n * @param {Object} args something with a length\n * @param {Number} slice\n * @param {Number} sliceEnd\n * @api public\n */\n\nmodule.exports = function (args, slice, sliceEnd) {\n  var ret = [];\n  var len = args.length;\n\n  if (0 === len) return ret;\n\n  var start = slice < 0\n    ? Math.max(0, slice + len)\n    : slice || 0;\n\n  if (sliceEnd !== undefined) {\n    len = sliceEnd < 0\n      ? sliceEnd + len\n      : sliceEnd\n  }\n\n  while (len-- > start) {\n    ret[len - start] = args[len];\n  }\n\n  return ret;\n}\n\n\n},{}],30:[function(require,module,exports){\n/** @jsx element */\n\n'use strict';\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar _vendorPhoenixJs = require(\"../vendor/phoenix.js\");\n\nvar _virtualElement = require('virtual-element');\n\nvar _virtualElement2 = _interopRequireDefault(_virtualElement);\n\nvar _deku = require('deku');\n\nvar _messages = require('./messages');\n\nvar _messages2 = _interopRequireDefault(_messages);\n\nvar chatMessages = [];\n\nvar app = (0, _deku.tree)((0, _virtualElement2['default'])(_messages2['default'], { messages: [] }));\napp.set('messages', chatMessages);\n\nconsole.log(app);\n\n(0, _deku.render)(app, document.querySelector('#messages'));\n\nvar socket = new _vendorPhoenixJs.Socket(\"/socket\", {\n\tlogger: function logger(kind, msg, data) {\n\t\tconsole.log(kind + ': ' + msg, data);\n\t}\n});\n\nsocket.connect({ user_id: \"123\" });\nvar $status = document.querySelector(\"#status\");\nvar $input = document.querySelector(\"#message-input\");\nvar $username = document.querySelector(\"#username\");\n\nsocket.onOpen(function (ev) {\n\treturn console.log(\"OPEN\", ev);\n});\nsocket.onError(function (ev) {\n\treturn console.log(\"ERROR\", ev);\n});\nsocket.onClose(function (e) {\n\treturn console.log(\"CLOSE\", e);\n});\n\nvar chan = socket.channel(\"rooms:lobby\", {});\nchan.join().receive(\"ignore\", function () {\n\treturn console.log(\"auth error\");\n}).receive(\"ok\", function () {\n\treturn console.log(\"join ok\");\n}).after(10000, function () {\n\treturn console.log(\"Connection interruption\");\n});\nchan.onError(function (e) {\n\treturn console.log(\"something went wrong\", e);\n});\nchan.onClose(function (e) {\n\treturn console.log(\"channel closed\", e);\n});\n\n$input.removeEventListener(\"keypress\");\n$input.addEventListener(\"keypress\", function (e) {\n\tif (e.keyCode == 13) {\n\t\tchan.push(\"new:msg\", { user: $username.value, body: $input.value });\n\t\t$input.value = '';\n\t}\n});\n\nchan.on(\"new:msg\", function (msg) {\n\tchatMessages.push(msg);\n\tapp.set('messages', chatMessages);\n});\n\nchan.on(\"user:entered\", function (msg) {\n\tmsg.user = msg.user || \"anonymous\";\n\tchatMessages.push(msg);\n\tapp.set('messages', chatMessages);\n});\n\n},{\"../vendor/phoenix.js\":32,\"./messages\":31,\"deku\":3,\"virtual-element\":26}],31:[function(require,module,exports){\n/** @jsx element */\n'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n\tvalue: true\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }\n\nvar _virtualElement = require('virtual-element');\n\nvar _virtualElement2 = _interopRequireDefault(_virtualElement);\n\nvar Component = {\n\tpropTypes: {\n\t\tmessages: {\n\t\t\tsource: 'messages'\n\t\t}\n\t},\n\n\trender: function render(_ref) {\n\t\tvar props = _ref.props;\n\t\tvar messages = props.messages;\n\t\tvar mountEle = props.mountEle;\n\n\t\tvar messageElements = messages.map(function (message) {\n\t\t\treturn (0, _virtualElement2['default'])(\n\t\t\t\t'p',\n\t\t\t\tnull,\n\t\t\t\t'[',\n\t\t\t\t(0, _virtualElement2['default'])(\n\t\t\t\t\t'a',\n\t\t\t\t\t{ href: '#' },\n\t\t\t\t\t'@',\n\t\t\t\t\tmessage.user\n\t\t\t\t),\n\t\t\t\t']: ',\n\t\t\t\tmessage.body\n\t\t\t);\n\t\t});\n\n\t\treturn (0, _virtualElement2['default'])(\n\t\t\t'div',\n\t\t\t{ style: 'overflow: auto; height: 100%;' },\n\t\t\tmessageElements\n\t\t);\n\t},\n\n\tafterRender: function afterRender(component, el) {\n\t\tel.scrollTop = el.scrollHeight;\n\t}\n};\n\nexports['default'] = Component;\nmodule.exports = exports['default'];\n\n},{\"virtual-element\":26}],32:[function(require,module,exports){\n// Phoenix Channels JavaScript client\n//\n// ## Socket Connection\n//\n// A single connection is established to the server and\n// channels are mulitplexed over the connection.\n// Connect to the server using the `Socket` class:\n//\n//     let socket = new Socket(\"/ws\")\n//     socket.connect({userToken: \"123\"})\n//\n// The `Socket` constructor takes the mount point of the socket\n// as well as options that can be found in the Socket docs,\n// such as configuring the `LongPoll` transport, and heartbeat.\n// Socket params can also be passed as an object literal to `connect`.\n//\n// ## Channels\n//\n// Channels are isolated, concurrent processes on the server that\n// subscribe to topics and broker events between the client and server.\n// To join a channel, you must provide the topic, and channel params for\n// authorization. Here's an example chat room example where `\"new_msg\"`\n// events are listened for, messages are pushed to the server, and\n// the channel is joined with ok/error matches, and `after` hook:\n//\n//     let channel = socket.channel(\"rooms:123\", {token: roomToken})\n//     channel.on(\"new_msg\", msg => console.log(\"Got message\", msg) )\n//     $input.onEnter( e => {\n//       channel.push(\"new_msg\", {body: e.target.val})\n//        .receive(\"ok\", (msg) => console.log(\"created message\", msg) )\n//        .receive(\"error\", (reasons) => console.log(\"create failed\", reasons) )\n//        .after(10000, () => console.log(\"Networking issue. Still waiting...\") )\n//     })\n//     channel.join()\n//       .receive(\"ok\", ({messages}) => console.log(\"catching up\", messages) )\n//       .receive(\"error\", ({reason}) => console.log(\"failed join\", reason) )\n//       .after(10000, () => console.log(\"Networking issue. Still waiting...\") )\n//\n//\n// ## Joining\n//\n// Joining a channel with `channel.join(topic, params)`, binds the params to\n// `channel.params`. Subsequent rejoins will send up the modified params for\n// updating authorization params, or passing up last_message_id information.\n// Successful joins receive an \"ok\" status, while unsuccessful joins\n// receive \"error\".\n//\n//\n// ## Pushing Messages\n//\n// From the previous example, we can see that pushing messages to the server\n// can be done with `channel.push(eventName, payload)` and we can optionally\n// receive responses from the push. Additionally, we can use\n// `after(millsec, callback)` to abort waiting for our `receive` hooks and\n// take action after some period of waiting.\n//\n//\n// ## Socket Hooks\n//\n// Lifecycle events of the multiplexed connection can be hooked into via\n// `socket.onError()` and `socket.onClose()` events, ie:\n//\n//     socket.onError( () => console.log(\"there was an error with the connection!\") )\n//     socket.onClose( () => console.log(\"the connection dropped\") )\n//\n//\n// ## Channel Hooks\n//\n// For each joined channel, you can bind to `onError` and `onClose` events\n// to monitor the channel lifecycle, ie:\n//\n//     channel.onError( () => console.log(\"there was an error!\") )\n//     channel.onClose( () => console.log(\"the channel has gone away gracefully\") )\n//\n// ### onError hooks\n//\n// `onError` hooks are invoked if the socket connection drops, or the channel\n// crashes on the server. In either case, a channel rejoin is attemtped\n// automatically in an exponential backoff manner.\n//\n// ### onClose hooks\n//\n// `onClose` hooks are invoked only in two cases. 1) the channel explicitly\n// closed on the server, or 2). The client explicitly closed, by calling\n// `channel.leave()`\n//\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar SOCKET_STATES = { connecting: 0, open: 1, closing: 2, closed: 3 };\nvar CHANNEL_STATES = {\n  closed: \"closed\",\n  errored: \"errored\",\n  joined: \"joined\",\n  joining: \"joining\"\n};\nvar CHANNEL_EVENTS = {\n  close: \"phx_close\",\n  error: \"phx_error\",\n  join: \"phx_join\",\n  reply: \"phx_reply\",\n  leave: \"phx_leave\"\n};\nvar TRANSPORTS = {\n  longpoll: \"longpoll\",\n  websocket: \"websocket\"\n};\n\nvar Push = (function () {\n\n  // Initializes the Push\n  //\n  // channel - The Channelnel\n  // event - The event, for example `\"phx_join\"`\n  // payload - The payload, for example `{user_id: 123}`\n  //\n\n  function Push(channel, event, payload) {\n    _classCallCheck(this, Push);\n\n    this.channel = channel;\n    this.event = event;\n    this.payload = payload || {};\n    this.receivedResp = null;\n    this.afterHook = null;\n    this.recHooks = [];\n    this.sent = false;\n  }\n\n  _createClass(Push, [{\n    key: \"send\",\n    value: function send() {\n      var _this = this;\n\n      var ref = this.channel.socket.makeRef();\n      this.refEvent = this.channel.replyEventName(ref);\n      this.receivedResp = null;\n      this.sent = false;\n\n      this.channel.on(this.refEvent, function (payload) {\n        _this.receivedResp = payload;\n        _this.matchReceive(payload);\n        _this.cancelRefEvent();\n        _this.cancelAfter();\n      });\n\n      this.startAfter();\n      this.sent = true;\n      this.channel.socket.push({\n        topic: this.channel.topic,\n        event: this.event,\n        payload: this.payload,\n        ref: ref\n      });\n    }\n  }, {\n    key: \"receive\",\n    value: function receive(status, callback) {\n      if (this.receivedResp && this.receivedResp.status === status) {\n        callback(this.receivedResp.response);\n      }\n\n      this.recHooks.push({ status: status, callback: callback });\n      return this;\n    }\n  }, {\n    key: \"after\",\n    value: function after(ms, callback) {\n      if (this.afterHook) {\n        throw \"only a single after hook can be applied to a push\";\n      }\n      var timer = null;\n      if (this.sent) {\n        timer = setTimeout(callback, ms);\n      }\n      this.afterHook = { ms: ms, callback: callback, timer: timer };\n      return this;\n    }\n\n    // private\n\n  }, {\n    key: \"matchReceive\",\n    value: function matchReceive(_ref) {\n      var status = _ref.status;\n      var response = _ref.response;\n      var ref = _ref.ref;\n\n      this.recHooks.filter(function (h) {\n        return h.status === status;\n      }).forEach(function (h) {\n        return h.callback(response);\n      });\n    }\n  }, {\n    key: \"cancelRefEvent\",\n    value: function cancelRefEvent() {\n      this.channel.off(this.refEvent);\n    }\n  }, {\n    key: \"cancelAfter\",\n    value: function cancelAfter() {\n      if (!this.afterHook) {\n        return;\n      }\n      clearTimeout(this.afterHook.timer);\n      this.afterHook.timer = null;\n    }\n  }, {\n    key: \"startAfter\",\n    value: function startAfter() {\n      var _this2 = this;\n\n      if (!this.afterHook) {\n        return;\n      }\n      var callback = function callback() {\n        _this2.cancelRefEvent();\n        _this2.afterHook.callback();\n      };\n      this.afterHook.timer = setTimeout(callback, this.afterHook.ms);\n    }\n  }]);\n\n  return Push;\n})();\n\nvar Channel = (function () {\n  function Channel(topic, params, socket) {\n    var _this3 = this;\n\n    _classCallCheck(this, Channel);\n\n    this.state = CHANNEL_STATES.closed;\n    this.topic = topic;\n    this.params = params || {};\n    this.socket = socket;\n    this.bindings = [];\n    this.joinedOnce = false;\n    this.joinPush = new Push(this, CHANNEL_EVENTS.join, this.params);\n    this.pushBuffer = [];\n    this.rejoinTimer = new Timer(function () {\n      return _this3.rejoinUntilConnected();\n    }, this.socket.reconnectAfterMs);\n    this.joinPush.receive(\"ok\", function () {\n      _this3.state = CHANNEL_STATES.joined;\n      _this3.rejoinTimer.reset();\n    });\n    this.onClose(function () {\n      _this3.socket.log(\"channel\", \"close \" + _this3.topic);\n      _this3.state = CHANNEL_STATES.closed;\n      _this3.socket.remove(_this3);\n    });\n    this.onError(function (reason) {\n      _this3.socket.log(\"channel\", \"error \" + _this3.topic, reason);\n      _this3.state = CHANNEL_STATES.errored;\n      _this3.rejoinTimer.setTimeout();\n    });\n    this.on(CHANNEL_EVENTS.reply, function (payload, ref) {\n      _this3.trigger(_this3.replyEventName(ref), payload);\n    });\n  }\n\n  _createClass(Channel, [{\n    key: \"rejoinUntilConnected\",\n    value: function rejoinUntilConnected() {\n      this.rejoinTimer.setTimeout();\n      if (this.socket.isConnected()) {\n        this.rejoin();\n      }\n    }\n  }, {\n    key: \"join\",\n    value: function join() {\n      if (this.joinedOnce) {\n        throw \"tried to join multiple times. 'join' can only be called a single time per channel instance\";\n      } else {\n        this.joinedOnce = true;\n      }\n      this.sendJoin();\n      return this.joinPush;\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(callback) {\n      this.on(CHANNEL_EVENTS.close, callback);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(callback) {\n      this.on(CHANNEL_EVENTS.error, function (reason) {\n        return callback(reason);\n      });\n    }\n  }, {\n    key: \"on\",\n    value: function on(event, callback) {\n      this.bindings.push({ event: event, callback: callback });\n    }\n  }, {\n    key: \"off\",\n    value: function off(event) {\n      this.bindings = this.bindings.filter(function (bind) {\n        return bind.event !== event;\n      });\n    }\n  }, {\n    key: \"canPush\",\n    value: function canPush() {\n      return this.socket.isConnected() && this.state === CHANNEL_STATES.joined;\n    }\n  }, {\n    key: \"push\",\n    value: function push(event, payload) {\n      if (!this.joinedOnce) {\n        throw \"tried to push '\" + event + \"' to '\" + this.topic + \"' before joining. Use channel.join() before pushing events\";\n      }\n      var pushEvent = new Push(this, event, payload);\n      if (this.canPush()) {\n        pushEvent.send();\n      } else {\n        this.pushBuffer.push(pushEvent);\n      }\n\n      return pushEvent;\n    }\n\n    // Leaves the channel\n    //\n    // Unsubscribes from server events, and\n    // instructs channel to terminate on server\n    //\n    // Triggers onClose() hooks\n    //\n    // To receive leave acknowledgements, use the a `receive`\n    // hook to bind to the server ack, ie:\n    //\n    //     channel.leave().receive(\"ok\", () => alert(\"left!\") )\n    //\n  }, {\n    key: \"leave\",\n    value: function leave() {\n      var _this4 = this;\n\n      return this.push(CHANNEL_EVENTS.leave).receive(\"ok\", function () {\n        _this4.socket.log(\"channel\", \"leave \" + _this4.topic);\n        _this4.trigger(CHANNEL_EVENTS.close, \"leave\");\n      });\n    }\n\n    // Overridable message hook\n    //\n    // Receives all events for specialized message handling\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(event, payload, ref) {}\n\n    // private\n\n  }, {\n    key: \"isMember\",\n    value: function isMember(topic) {\n      return this.topic === topic;\n    }\n  }, {\n    key: \"sendJoin\",\n    value: function sendJoin() {\n      this.state = CHANNEL_STATES.joining;\n      this.joinPush.send();\n    }\n  }, {\n    key: \"rejoin\",\n    value: function rejoin() {\n      this.sendJoin();\n      this.pushBuffer.forEach(function (pushEvent) {\n        return pushEvent.send();\n      });\n      this.pushBuffer = [];\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(triggerEvent, payload, ref) {\n      this.onMessage(triggerEvent, payload, ref);\n      this.bindings.filter(function (bind) {\n        return bind.event === triggerEvent;\n      }).map(function (bind) {\n        return bind.callback(payload, ref);\n      });\n    }\n  }, {\n    key: \"replyEventName\",\n    value: function replyEventName(ref) {\n      return \"chan_reply_\" + ref;\n    }\n  }]);\n\n  return Channel;\n})();\n\nexports.Channel = Channel;\n\nvar Socket = (function () {\n\n  // Initializes the Socket\n  //\n  // endPoint - The string WebSocket endpoint, ie, \"ws://example.com/ws\",\n  //                                               \"wss://example.com\"\n  //                                               \"/ws\" (inherited host & protocol)\n  // opts - Optional configuration\n  //   transport - The Websocket Transport, for example WebSocket or Phoenix.LongPoll.\n  //               Defaults to WebSocket with automatic LongPoll fallback.\n  //   heartbeatIntervalMs - The millisec interval to send a heartbeat message\n  //   reconnectAfterMs - The optional function that returns the millsec\n  //                      reconnect interval. Defaults to stepped backoff of:\n  //\n  //     function(tries){\n  //       return [1000, 5000, 10000][tries - 1] || 10000\n  //     }\n  //\n  //   logger - The optional function for specialized logging, ie:\n  //     `logger: (kind, msg, data) => { console.log(`${kind}: ${msg}`, data) }\n  //\n  //   longpollerTimeout - The maximum timeout of a long poll AJAX request.\n  //                        Defaults to 20s (double the server long poll timer).\n  //\n  // For IE8 support use an ES5-shim (https://github.com/es-shims/es5-shim)\n  //\n\n  function Socket(endPoint) {\n    var _this5 = this;\n\n    var opts = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    _classCallCheck(this, Socket);\n\n    this.stateChangeCallbacks = { open: [], close: [], error: [], message: [] };\n    this.channels = [];\n    this.sendBuffer = [];\n    this.ref = 0;\n    this.transport = opts.transport || window.WebSocket || LongPoll;\n    this.heartbeatIntervalMs = opts.heartbeatIntervalMs || 30000;\n    this.reconnectAfterMs = opts.reconnectAfterMs || function (tries) {\n      return [1000, 5000, 10000][tries - 1] || 10000;\n    };\n    this.logger = opts.logger || function () {}; // noop\n    this.longpollerTimeout = opts.longpollerTimeout || 20000;\n    this.params = {};\n    this.reconnectTimer = new Timer(function () {\n      return _this5.connect(_this5.params);\n    }, this.reconnectAfterMs);\n    this.endPoint = endPoint + \"/\" + TRANSPORTS.websocket;\n  }\n\n  _createClass(Socket, [{\n    key: \"protocol\",\n    value: function protocol() {\n      return location.protocol.match(/^https/) ? \"wss\" : \"ws\";\n    }\n  }, {\n    key: \"endPointURL\",\n    value: function endPointURL() {\n      var uri = Ajax.appendParams(this.endPoint, this.params);\n      if (uri.charAt(0) !== \"/\") {\n        return uri;\n      }\n      if (uri.charAt(1) === \"/\") {\n        return this.protocol() + \":\" + uri;\n      }\n\n      return this.protocol() + \"://\" + location.host + uri;\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect(callback, code, reason) {\n      if (this.conn) {\n        this.conn.onclose = function () {}; // noop\n        if (code) {\n          this.conn.close(code, reason || \"\");\n        } else {\n          this.conn.close();\n        }\n        this.conn = null;\n      }\n      callback && callback();\n    }\n\n    // params - The params to send when connecting, for example `{user_id: userToken}`\n  }, {\n    key: \"connect\",\n    value: function connect() {\n      var _this6 = this;\n\n      var params = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n      this.params = params;\n      this.disconnect(function () {\n        _this6.conn = new _this6.transport(_this6.endPointURL());\n        _this6.conn.timeout = _this6.longpollerTimeout;\n        _this6.conn.onopen = function () {\n          return _this6.onConnOpen();\n        };\n        _this6.conn.onerror = function (error) {\n          return _this6.onConnError(error);\n        };\n        _this6.conn.onmessage = function (event) {\n          return _this6.onConnMessage(event);\n        };\n        _this6.conn.onclose = function (event) {\n          return _this6.onConnClose(event);\n        };\n      });\n    }\n\n    // Logs the message. Override `this.logger` for specialized logging. noops by default\n  }, {\n    key: \"log\",\n    value: function log(kind, msg, data) {\n      this.logger(kind, msg, data);\n    }\n\n    // Registers callbacks for connection state change events\n    //\n    // Examples\n    //\n    //    socket.onError(function(error){ alert(\"An error occurred\") })\n    //\n  }, {\n    key: \"onOpen\",\n    value: function onOpen(callback) {\n      this.stateChangeCallbacks.open.push(callback);\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(callback) {\n      this.stateChangeCallbacks.close.push(callback);\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(callback) {\n      this.stateChangeCallbacks.error.push(callback);\n    }\n  }, {\n    key: \"onMessage\",\n    value: function onMessage(callback) {\n      this.stateChangeCallbacks.message.push(callback);\n    }\n  }, {\n    key: \"onConnOpen\",\n    value: function onConnOpen() {\n      var _this7 = this;\n\n      this.log(\"transport\", \"connected to \" + this.endPointURL(), this.transport.prototype);\n      this.flushSendBuffer();\n      this.reconnectTimer.reset();\n      if (!this.conn.skipHeartbeat) {\n        clearInterval(this.heartbeatTimer);\n        this.heartbeatTimer = setInterval(function () {\n          return _this7.sendHeartbeat();\n        }, this.heartbeatIntervalMs);\n      }\n      this.stateChangeCallbacks.open.forEach(function (callback) {\n        return callback();\n      });\n    }\n  }, {\n    key: \"onConnClose\",\n    value: function onConnClose(event) {\n      this.log(\"transport\", \"close\", event);\n      this.triggerChanError();\n      clearInterval(this.heartbeatTimer);\n      this.reconnectTimer.setTimeout();\n      this.stateChangeCallbacks.close.forEach(function (callback) {\n        return callback(event);\n      });\n    }\n  }, {\n    key: \"onConnError\",\n    value: function onConnError(error) {\n      this.log(\"transport\", error);\n      this.triggerChanError();\n      this.stateChangeCallbacks.error.forEach(function (callback) {\n        return callback(error);\n      });\n    }\n  }, {\n    key: \"triggerChanError\",\n    value: function triggerChanError() {\n      this.channels.forEach(function (channel) {\n        return channel.trigger(CHANNEL_EVENTS.error);\n      });\n    }\n  }, {\n    key: \"connectionState\",\n    value: function connectionState() {\n      switch (this.conn && this.conn.readyState) {\n        case SOCKET_STATES.connecting:\n          return \"connecting\";\n        case SOCKET_STATES.open:\n          return \"open\";\n        case SOCKET_STATES.closing:\n          return \"closing\";\n        default:\n          return \"closed\";\n      }\n    }\n  }, {\n    key: \"isConnected\",\n    value: function isConnected() {\n      return this.connectionState() === \"open\";\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(channel) {\n      this.channels = this.channels.filter(function (c) {\n        return !c.isMember(channel.topic);\n      });\n    }\n  }, {\n    key: \"channel\",\n    value: function channel(topic) {\n      var chanParams = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n      var channel = new Channel(topic, chanParams, this);\n      this.channels.push(channel);\n      return channel;\n    }\n  }, {\n    key: \"push\",\n    value: function push(data) {\n      var _this8 = this;\n\n      var topic = data.topic;\n      var event = data.event;\n      var payload = data.payload;\n      var ref = data.ref;\n\n      var callback = function callback() {\n        return _this8.conn.send(JSON.stringify(data));\n      };\n      this.log(\"push\", topic + \" \" + event + \" (\" + ref + \")\", payload);\n      if (this.isConnected()) {\n        callback();\n      } else {\n        this.sendBuffer.push(callback);\n      }\n    }\n\n    // Return the next message ref, accounting for overflows\n  }, {\n    key: \"makeRef\",\n    value: function makeRef() {\n      var newRef = this.ref + 1;\n      if (newRef === this.ref) {\n        this.ref = 0;\n      } else {\n        this.ref = newRef;\n      }\n\n      return this.ref.toString();\n    }\n  }, {\n    key: \"sendHeartbeat\",\n    value: function sendHeartbeat() {\n      this.push({ topic: \"phoenix\", event: \"heartbeat\", payload: {}, ref: this.makeRef() });\n    }\n  }, {\n    key: \"flushSendBuffer\",\n    value: function flushSendBuffer() {\n      if (this.isConnected() && this.sendBuffer.length > 0) {\n        this.sendBuffer.forEach(function (callback) {\n          return callback();\n        });\n        this.sendBuffer = [];\n      }\n    }\n  }, {\n    key: \"onConnMessage\",\n    value: function onConnMessage(rawMessage) {\n      var msg = JSON.parse(rawMessage.data);\n      var topic = msg.topic;\n      var event = msg.event;\n      var payload = msg.payload;\n      var ref = msg.ref;\n\n      this.log(\"receive\", (payload.status || \"\") + \" \" + topic + \" \" + event + \" \" + (ref && \"(\" + ref + \")\" || \"\"), payload);\n      this.channels.filter(function (channel) {\n        return channel.isMember(topic);\n      }).forEach(function (channel) {\n        return channel.trigger(event, payload, ref);\n      });\n      this.stateChangeCallbacks.message.forEach(function (callback) {\n        return callback(msg);\n      });\n    }\n  }]);\n\n  return Socket;\n})();\n\nexports.Socket = Socket;\n\nvar LongPoll = (function () {\n  function LongPoll(endPoint) {\n    _classCallCheck(this, LongPoll);\n\n    this.endPoint = null;\n    this.token = null;\n    this.skipHeartbeat = true;\n    this.onopen = function () {}; // noop\n    this.onerror = function () {}; // noop\n    this.onmessage = function () {}; // noop\n    this.onclose = function () {}; // noop\n    this.pollEndpoint = this.normalizeEndpoint(endPoint);\n    this.readyState = SOCKET_STATES.connecting;\n\n    this.poll();\n  }\n\n  _createClass(LongPoll, [{\n    key: \"normalizeEndpoint\",\n    value: function normalizeEndpoint(endPoint) {\n      return endPoint.replace(\"ws://\", \"http://\").replace(\"wss://\", \"https://\").replace(new RegExp(\"(.*)\\/\" + TRANSPORTS.websocket), \"$1/\" + TRANSPORTS.longpoll);\n    }\n  }, {\n    key: \"endpointURL\",\n    value: function endpointURL() {\n      return Ajax.appendParams(this.pollEndpoint, {\n        token: this.token,\n        format: \"json\"\n      });\n    }\n  }, {\n    key: \"closeAndRetry\",\n    value: function closeAndRetry() {\n      this.close();\n      this.readyState = SOCKET_STATES.connecting;\n    }\n  }, {\n    key: \"ontimeout\",\n    value: function ontimeout() {\n      this.onerror(\"timeout\");\n      this.closeAndRetry();\n    }\n  }, {\n    key: \"poll\",\n    value: function poll() {\n      var _this9 = this;\n\n      if (!(this.readyState === SOCKET_STATES.open || this.readyState === SOCKET_STATES.connecting)) {\n        return;\n      }\n\n      Ajax.request(\"GET\", this.endpointURL(), \"application/json\", null, this.timeout, this.ontimeout.bind(this), function (resp) {\n        if (resp) {\n          var status = resp.status;\n          var token = resp.token;\n          var messages = resp.messages;\n\n          _this9.token = token;\n        } else {\n          var status = 0;\n        }\n\n        switch (status) {\n          case 200:\n            messages.forEach(function (msg) {\n              return _this9.onmessage({ data: JSON.stringify(msg) });\n            });\n            _this9.poll();\n            break;\n          case 204:\n            _this9.poll();\n            break;\n          case 410:\n            _this9.readyState = SOCKET_STATES.open;\n            _this9.onopen();\n            _this9.poll();\n            break;\n          case 0:\n          case 500:\n            _this9.onerror();\n            _this9.closeAndRetry();\n            break;\n          default:\n            throw \"unhandled poll status \" + status;\n        }\n      });\n    }\n  }, {\n    key: \"send\",\n    value: function send(body) {\n      var _this10 = this;\n\n      Ajax.request(\"POST\", this.endpointURL(), \"application/json\", body, this.timeout, this.onerror.bind(this, \"timeout\"), function (resp) {\n        if (!resp || resp.status !== 200) {\n          _this10.onerror(status);\n          _this10.closeAndRetry();\n        }\n      });\n    }\n  }, {\n    key: \"close\",\n    value: function close(code, reason) {\n      this.readyState = SOCKET_STATES.closed;\n      this.onclose();\n    }\n  }]);\n\n  return LongPoll;\n})();\n\nexports.LongPoll = LongPoll;\n\nvar Ajax = (function () {\n  function Ajax() {\n    _classCallCheck(this, Ajax);\n  }\n\n  _createClass(Ajax, null, [{\n    key: \"request\",\n    value: function request(method, endPoint, accept, body, timeout, ontimeout, callback) {\n      if (window.XDomainRequest) {\n        var req = new XDomainRequest(); // IE8, IE9\n        this.xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback);\n      } else {\n        var req = window.XMLHttpRequest ? new XMLHttpRequest() : // IE7+, Firefox, Chrome, Opera, Safari\n        new ActiveXObject(\"Microsoft.XMLHTTP\"); // IE6, IE5\n        this.xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback);\n      }\n    }\n  }, {\n    key: \"xdomainRequest\",\n    value: function xdomainRequest(req, method, endPoint, body, timeout, ontimeout, callback) {\n      var _this11 = this;\n\n      req.timeout = timeout;\n      req.open(method, endPoint);\n      req.onload = function () {\n        var response = _this11.parseJSON(req.responseText);\n        callback && callback(response);\n      };\n      if (ontimeout) {\n        req.ontimeout = ontimeout;\n      }\n\n      // Work around bug in IE9 that requires an attached onprogress handler\n      req.onprogress = function () {};\n\n      req.send(body);\n    }\n  }, {\n    key: \"xhrRequest\",\n    value: function xhrRequest(req, method, endPoint, accept, body, timeout, ontimeout, callback) {\n      var _this12 = this;\n\n      req.timeout = timeout;\n      req.open(method, endPoint, true);\n      req.setRequestHeader(\"Content-Type\", accept);\n      req.onerror = function () {\n        callback && callback(null);\n      };\n      req.onreadystatechange = function () {\n        if (req.readyState === _this12.states.complete && callback) {\n          var response = _this12.parseJSON(req.responseText);\n          callback(response);\n        }\n      };\n      if (ontimeout) {\n        req.ontimeout = ontimeout;\n      }\n\n      req.send(body);\n    }\n  }, {\n    key: \"parseJSON\",\n    value: function parseJSON(resp) {\n      return resp && resp !== \"\" ? JSON.parse(resp) : null;\n    }\n  }, {\n    key: \"serialize\",\n    value: function serialize(obj, parentKey) {\n      var queryStr = [];\n      for (var key in obj) {\n        if (!obj.hasOwnProperty(key)) {\n          continue;\n        }\n        var paramKey = parentKey ? parentKey + \"[\" + key + \"]\" : key;\n        var paramVal = obj[key];\n        if (typeof paramVal === \"object\") {\n          queryStr.push(this.serialize(paramVal, paramKey));\n        } else {\n          queryStr.push(encodeURIComponent(paramKey) + \"=\" + encodeURIComponent(paramVal));\n        }\n      }\n      return queryStr.join(\"&\");\n    }\n  }, {\n    key: \"appendParams\",\n    value: function appendParams(url, params) {\n      if (Object.keys(params).length === 0) {\n        return url;\n      }\n\n      var prefix = url.match(/\\?/) ? \"&\" : \"?\";\n      return \"\" + url + prefix + this.serialize(params);\n    }\n  }]);\n\n  return Ajax;\n})();\n\nexports.Ajax = Ajax;\n\nAjax.states = { complete: 4 };\n\n// Creates a timer that accepts a `timerCalc` function to perform\n// calculated timeout retries, such as exponential backoff.\n//\n// ## Examples\n//\n//    let reconnectTimer = new Timer(() => this.connect(), function(tries){\n//      return [1000, 5000, 10000][tries - 1] || 10000\n//    })\n//    reconnectTimer.setTimeout() // fires after 1000\n//    reconnectTimer.setTimeout() // fires after 5000\n//    reconnectTimer.reset()\n//    reconnectTimer.setTimeout() // fires after 1000\n//\n\nvar Timer = (function () {\n  function Timer(callback, timerCalc) {\n    _classCallCheck(this, Timer);\n\n    this.callback = callback;\n    this.timerCalc = timerCalc;\n    this.timer = null;\n    this.tries = 0;\n  }\n\n  _createClass(Timer, [{\n    key: \"reset\",\n    value: function reset() {\n      this.tries = 0;\n      clearTimeout(this.timer);\n    }\n\n    // Cancels any previous setTimeout and schedules callback\n  }, {\n    key: \"setTimeout\",\n    value: (function (_setTimeout) {\n      function setTimeout() {\n        return _setTimeout.apply(this, arguments);\n      }\n\n      setTimeout.toString = function () {\n        return _setTimeout.toString();\n      };\n\n      return setTimeout;\n    })(function () {\n      var _this13 = this;\n\n      clearTimeout(this.timer);\n\n      this.timer = setTimeout(function () {\n        _this13.tries = _this13.tries + 1;\n        _this13.callback();\n      }, this.timerCalc(this.tries + 1));\n    })\n  }]);\n\n  return Timer;\n})();\n\n},{}]},{},[30]);\n"],"sourceRoot":"/source/"}